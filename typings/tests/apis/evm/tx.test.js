"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const evm_1 = require("../../../src/apis/evm");
const constants_1 = require("../../../src/utils/constants");
const constants_2 = require("../../../src/utils/constants");
const evm_2 = require("../../../src/apis/evm");
const bn_js_1 = __importDefault(require("bn.js"));
const src_1 = require("src");
const networkID = 1337;
const cHexAddress1 = "0x8db97C7cEcE249c2b98bDC0226Cc4C2A57BF52FC";
const bintools = src_1.BinTools.getInstance();
const cHexAddress2 = "0xecC3B2968B277b837a81A7181e0b94EB1Ca54EdE";
const antAssetID = "F4MyJcUvq3Rxbqgd4Zs8sUpvwLHApyrp4yxJXe2bAV86Vvp38";
const axcAssetID = constants_1.Defaults.network[networkID].Swap.axcAssetID;
const txID = "QVb7DtKjcwVYLFWHgnGSdzQtQSc29KeRBYFNCBnbFu6dFqX7z";
const blockchainID = constants_1.Defaults.network[networkID].AX.blockchainID;
const sourcechainID = constants_1.Defaults.network[networkID].Swap.blockchainID;
let evmOutputs;
let importedIns;
const fee = constants_1.Defaults.network[networkID].AX.txFee;
beforeEach(() => {
    evmOutputs = [];
    importedIns = [];
});
describe("EVM Transactions", () => {
    describe("ImportTx", () => {
        test("Multiple AXC EVMOutput fail", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(constants_2.ONEAXC);
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(axcAssetID), input);
            importedIns.push(xferin);
            // Creating 2 outputs with the same address and AXC assetID is invalid
            let evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAXC, axcAssetID);
            evmOutputs.push(evmOutput);
            evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAXC, axcAssetID);
            evmOutputs.push(evmOutput);
            expect(() => {
                new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs);
            }).toThrow("Error - ImportTx: duplicate (address, assetId) pair found in outputs: (0x8db97c7cece249c2b98bdc0226cc4c2a57bf52fc, BUuypiq2wyuLMvyhzFXcPyxPMCgSp7eeDohhQRqTChoBjKziC)");
        });
        test("Multiple AXC EVMOutput success", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(constants_2.ONEAXC);
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(axcAssetID), input);
            importedIns.push(xferin);
            // Creating 2 outputs with different addresses valid
            let evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAXC.div(new bn_js_1.default(3)), axcAssetID);
            evmOutputs.push(evmOutput);
            evmOutput = new evm_2.EVMOutput(cHexAddress2, constants_2.ONEAXC.div(new bn_js_1.default(3)), axcAssetID);
            evmOutputs.push(evmOutput);
            const importTx = new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs);
            expect(importTx).toBeInstanceOf(evm_1.ImportTx);
            expect(importTx.getSourceChain().toString("hex")).toBe(bintools.cb58Decode(sourcechainID).toString("hex"));
        });
        test("Multiple ANT EVMOutput fail", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(new bn_js_1.default(507));
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(axcAssetID), input);
            importedIns.push(xferin);
            // Creating 2 outputs with the same address and ANT assetID is invalid
            let evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAXC, antAssetID);
            evmOutputs.push(evmOutput);
            evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAXC, antAssetID);
            evmOutputs.push(evmOutput);
            expect(() => {
                new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs);
            }).toThrow("Error - ImportTx: duplicate (address, assetId) pair found in outputs: (0x8db97c7cece249c2b98bdc0226cc4c2a57bf52fc, F4MyJcUvq3Rxbqgd4Zs8sUpvwLHApyrp4yxJXe2bAV86Vvp38)");
        });
        test("Multiple ANT EVMOutput success", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(fee);
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(axcAssetID), input);
            importedIns.push(xferin);
            let evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAXC, antAssetID);
            evmOutputs.push(evmOutput);
            evmOutput = new evm_2.EVMOutput(cHexAddress2, constants_2.ONEAXC, antAssetID);
            evmOutputs.push(evmOutput);
            const importTx = new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs);
            expect(importTx).toBeInstanceOf(evm_1.ImportTx);
        });
        test("Single ANT EVMOutput fail", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(new bn_js_1.default(0));
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(axcAssetID), input);
            importedIns.push(xferin);
            // If the output is a non-axc assetID then don't subtract a fee
            const evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAXC, antAssetID);
            evmOutputs.push(evmOutput);
            const baseFee = new bn_js_1.default(25000000000);
            expect(() => {
                new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs, baseFee);
            }).toThrow("Error - 25000000000 nAXC required for fee and only 0 nAXC provided");
        });
        test("Single ANT EVMOutput success", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(constants_2.ONEAXC);
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(axcAssetID), input);
            importedIns.push(xferin);
            const evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAXC, antAssetID);
            evmOutputs.push(evmOutput);
            const importTx = new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs);
            expect(importTx).toBeInstanceOf(evm_1.ImportTx);
        });
        test("Single AXC EVMOutput fail", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(new bn_js_1.default(507));
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(axcAssetID), input);
            importedIns.push(xferin);
            const evmOutput = new evm_2.EVMOutput(cHexAddress1, new bn_js_1.default(0), axcAssetID);
            evmOutputs.push(evmOutput);
            const baseFee = new bn_js_1.default(25000000000);
            expect(() => {
                new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs, baseFee);
            }).toThrow("Error - 25000000000 nAXC required for fee and only 507 nAXC provided");
        });
        test("Single AXC EVMOutput success", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(constants_2.ONEAXC);
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(axcAssetID), input);
            importedIns.push(xferin);
            const evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAXC.sub(constants_1.MILLIAXC), axcAssetID);
            evmOutputs.push(evmOutput);
            const importTx = new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs);
            expect(importTx).toBeInstanceOf(evm_1.ImportTx);
        });
    });
    describe("ExportTx", () => {
        test("getDestinationChain", () => {
            const exportTx = new evm_1.ExportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(constants_1.PlatformChainID));
            expect(exportTx).toBeInstanceOf(evm_1.ExportTx);
            expect(exportTx.getDestinationChain().toString("hex")).toBe(bintools.cb58Decode(constants_1.PlatformChainID).toString("hex"));
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHgudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Rlc3RzL2FwaXMvZXZtL3R4LnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSwrQ0FLOEI7QUFDOUIsNERBSXFDO0FBQ3JDLDREQUFxRDtBQUNyRCwrQ0FBaUQ7QUFDakQsa0RBQXNCO0FBQ3RCLDZCQUFzQztBQUN0QyxNQUFNLFNBQVMsR0FBVyxJQUFJLENBQUE7QUFDOUIsTUFBTSxZQUFZLEdBQVcsNENBQTRDLENBQUE7QUFDekUsTUFBTSxRQUFRLEdBQWEsY0FBUSxDQUFDLFdBQVcsRUFBRSxDQUFBO0FBQ2pELE1BQU0sWUFBWSxHQUFXLDRDQUE0QyxDQUFBO0FBQ3pFLE1BQU0sVUFBVSxHQUFXLG1EQUFtRCxDQUFBO0FBQzlFLE1BQU0sVUFBVSxHQUFXLG9CQUFRLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUE7QUFDdEUsTUFBTSxJQUFJLEdBQVcsbURBQW1ELENBQUE7QUFDeEUsTUFBTSxZQUFZLEdBQVcsb0JBQVEsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQTtBQUN4RSxNQUFNLGFBQWEsR0FBVyxvQkFBUSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFBO0FBQzNFLElBQUksVUFBdUIsQ0FBQTtBQUMzQixJQUFJLFdBQWdDLENBQUE7QUFDcEMsTUFBTSxHQUFHLEdBQU8sb0JBQVEsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQTtBQUVwRCxVQUFVLENBQUMsR0FBUyxFQUFFO0lBQ3BCLFVBQVUsR0FBRyxFQUFFLENBQUE7SUFDZixXQUFXLEdBQUcsRUFBRSxDQUFBO0FBQ2xCLENBQUMsQ0FBQyxDQUFBO0FBRUYsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFB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LEVBQUUsR0FBRyxFQUFFO1FBQ3hCLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxHQUFTLEVBQUU7WUFDckMsTUFBTSxRQUFRLEdBQWEsSUFBSSxjQUFRLENBQ3JDLFNBQVMsRUFDVCxRQUFRLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxFQUNqQyxRQUFRLENBQUMsVUFBVSxDQUFDLDJCQUFlLENBQUMsQ0FDckMsQ0FBQTtZQUNELE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxjQUFjLENBQUMsY0FBUSxDQUFDLENBQUE7WUFDekMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FDekQsUUFBUSxDQUFDLFVBQVUsQ0FBQywyQkFBZSxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUNyRCxDQUFBO1FBQ0gsQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDLENBQUMsQ0FBQTtBQUNKLENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBFeHBvcnRUeCxcclxuICBJbXBvcnRUeCxcclxuICBTRUNQVHJhbnNmZXJJbnB1dCxcclxuICBUcmFuc2ZlcmFibGVJbnB1dFxyXG59IGZyb20gXCIuLi8uLi8uLi9zcmMvYXBpcy9ldm1cIlxyXG5pbXBvcnQge1xyXG4gIERlZmF1bHRzLFxyXG4gIE1JTExJQVhDLFxyXG4gIFBsYXRmb3JtQ2hhaW5JRFxyXG59IGZyb20gXCIuLi8uLi8uLi9zcmMvdXRpbHMvY29uc3RhbnRzXCJcclxuaW1wb3J0IHsgT05FQVhDIH0gZnJvbSBcIi4uLy4uLy4uL3NyYy91dGlscy9jb25zdGFudHNcIlxyXG5pbXBvcnQgeyBFVk1PdXRwdXQgfSBmcm9tIFwiLi4vLi4vLi4vc3JjL2FwaXMvZXZtXCJcclxuaW1wb3J0IEJOIGZyb20gXCJibi5qc1wiXHJcbmltcG9ydCB7IEJpblRvb2xzLCBCdWZmZXIgfSBmcm9tIFwic3JjXCJcclxuY29uc3QgbmV0d29ya0lEOiBudW1iZXIgPSAxMzM3XHJcbmNvbnN0IGNIZXhBZGRyZXNzMTogc3RyaW5nID0gXCIweDhkYjk3QzdjRWNFMjQ5YzJiOThiREMwMjI2Q2M0QzJBNTdCRjUyRkNcIlxyXG5jb25zdCBiaW50b29sczogQmluVG9vbHMgPSBCaW5Ub29scy5nZXRJbnN0YW5jZSgpXHJcbmNvbnN0IGNIZXhBZGRyZXNzMjogc3RyaW5nID0gXCIweGVjQzNCMjk2OEIyNzdiODM3YTgxQTcxODFlMGI5NEVCMUNhNTRFZEVcIlxyXG5jb25zdCBhbnRBc3NldElEOiBzdHJpbmcgPSBcIkY0TXlKY1V2cTNSeGJxZ2Q0WnM4c1VwdndMSEFweXJwNHl4SlhlMmJBVjg2VnZwMzhcIlxyXG5jb25zdCBheGNBc3NldElEOiBzdHJpbmcgPSBEZWZhdWx0cy5uZXR3b3JrW25ldHdvcmtJRF0uU3dhcC5heGNBc3NldElEXHJcbmNvbnN0IHR4SUQ6IHN0cmluZyA9IFwiUVZiN0R0S2pjd1ZZTEZXSGduR1NkelF0UVNjMjlLZVJCWUZOQ0JuYkZ1NmRGcVg3elwiXHJcbmNvbnN0IGJsb2NrY2hhaW5JRDogc3RyaW5nID0gRGVmYXVsdHMubmV0d29ya1tuZXR3b3JrSURdLkFYLmJsb2NrY2hhaW5JRFxyXG5jb25zdCBzb3VyY2VjaGFpbklEOiBzdHJpbmcgPSBEZWZhdWx0cy5uZXR3b3JrW25ldHdvcmtJRF0uU3dhcC5ibG9ja2NoYWluSURcclxubGV0IGV2bU91dHB1dHM6IEVWTU91dHB1dFtdXHJcbmxldCBpbXBvcnRlZEluczogVHJhbnNmZXJhYmxlSW5wdXRbXVxyXG5jb25zdCBmZWU6IEJOID0gRGVmYXVsdHMubmV0d29ya1tuZXR3b3JrSURdLkFYLnR4RmVlXHJcblxyXG5iZWZvcmVFYWNoKCgpOiB2b2lkID0+IHtcclxuICBldm1PdXRwdXRzID0gW11cclxuICBpbXBvcnRlZElucyA9IFtdXHJcbn0pXHJcblxyXG5kZXNjcmliZShcIkVWTSBUcmFuc2FjdGlvbnNcIiwgKCkgPT4ge1xyXG4gIGRlc2NyaWJlKFwiSW1wb3J0VHhcIiwgKCkgPT4ge1xyXG4gICAgdGVzdChcIk11bHRpcGxlIEFYQyBFVk1PdXRwdXQgZmFpbFwiLCAoKTogdm9pZCA9PiB7XHJcbiAgICAgIGNvbnN0IG91dHB1dGlkeDogQnVmZmVyID0gQnVmZmVyLmZyb20oXCJcIilcclxuICAgICAgY29uc3QgaW5wdXQ6IFNFQ1BUcmFuc2ZlcklucHV0ID0gbmV3IFNFQ1BUcmFuc2ZlcklucHV0KE9ORUFYQylcclxuICAgICAgY29uc3QgeGZlcmluOiBUcmFuc2ZlcmFibGVJbnB1dCA9IG5ldyBUcmFuc2ZlcmFibGVJbnB1dChcclxuICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKHR4SUQpLFxyXG4gICAgICAgIG91dHB1dGlkeCxcclxuICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKGF4Y0Fzc2V0SUQpLFxyXG4gICAgICAgIGlucHV0XHJcbiAgICAgIClcclxuICAgICAgaW1wb3J0ZWRJbnMucHVzaCh4ZmVyaW4pXHJcbiAgICAgIC8vIENyZWF0aW5nIDIgb3V0cHV0cyB3aXRoIHRoZSBzYW1lIGFkZHJlc3MgYW5kIEFYQyBhc3NldElEIGlzIGludmFsaWRcclxuICAgICAgbGV0IGV2bU91dHB1dDogRVZNT3V0cHV0ID0gbmV3IEVWTU91dHB1dChjSGV4QWRkcmVzczEsIE9ORUFYQywgYXhjQXNzZXRJRClcclxuICAgICAgZXZtT3V0cHV0cy5wdXNoKGV2bU91dHB1dClcclxuICAgICAgZXZtT3V0cHV0ID0gbmV3IEVWTU91dHB1dChjSGV4QWRkcmVzczEsIE9ORUFYQywgYXhjQXNzZXRJRClcclxuICAgICAgZXZtT3V0cHV0cy5wdXNoKGV2bU91dHB1dClcclxuXHJcbiAgICAgIGV4cGVjdCgoKTogdm9pZCA9PiB7XHJcbiAgICAgICAgbmV3IEltcG9ydFR4KFxyXG4gICAgICAgICAgbmV0d29ya0lELFxyXG4gICAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShibG9ja2NoYWluSUQpLFxyXG4gICAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShzb3VyY2VjaGFpbklEKSxcclxuICAgICAgICAgIGltcG9ydGVkSW5zLFxyXG4gICAgICAgICAgZXZtT3V0cHV0c1xyXG4gICAgICAgIClcclxuICAgICAgfSkudG9UaHJvdyhcclxuICAgICAgICBcIkVycm9yIC0gSW1wb3J0VHg6IGR1cGxpY2F0ZSAoYWRkcmVzcywgYXNzZXRJZCkgcGFpciBmb3VuZCBpbiBvdXRwdXRzOiAoMHg4ZGI5N2M3Y2VjZTI0OWMyYjk4YmRjMDIyNmNjNGMyYTU3YmY1MmZjLCBCVXV5cGlxMnd5dUxNdnloekZYY1B5eFBNQ2dTcDdlZURvaGhRUnFUQ2hvQmpLemlDKVwiXHJcbiAgICAgIClcclxuICAgIH0pXHJcblxyXG4gICAgdGVzdChcIk11bHRpcGxlIEFYQyBFVk1PdXRwdXQgc3VjY2Vzc1wiLCAoKTogdm9pZCA9PiB7XHJcbiAgICAgIGNvbnN0IG91dHB1dGlkeDogQnVmZmVyID0gQnVmZmVyLmZyb20oXCJcIilcclxuICAgICAgY29uc3QgaW5wdXQ6IFNFQ1BUcmFuc2ZlcklucHV0ID0gbmV3IFNFQ1BUcmFuc2ZlcklucHV0KE9ORUFYQylcclxuICAgICAgY29uc3QgeGZlcmluOiBUcmFuc2ZlcmFibGVJbnB1dCA9IG5ldyBUcmFuc2ZlcmFibGVJbnB1dChcclxuICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKHR4SUQpLFxyXG4gICAgICAgIG91dHB1dGlkeCxcclxuICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKGF4Y0Fzc2V0SUQpLFxyXG4gICAgICAgIGlucHV0XHJcbiAgICAgIClcclxuICAgICAgaW1wb3J0ZWRJbnMucHVzaCh4ZmVyaW4pXHJcbiAgICAgIC8vIENyZWF0aW5nIDIgb3V0cHV0cyB3aXRoIGRpZmZlcmVudCBhZGRyZXNzZXMgdmFsaWRcclxuICAgICAgbGV0IGV2bU91dHB1dDogRVZNT3V0cHV0ID0gbmV3IEVWTU91dHB1dChcclxuICAgICAgICBjSGV4QWRkcmVzczEsXHJcbiAgICAgICAgT05FQVhDLmRpdihuZXcgQk4oMykpLFxyXG4gICAgICAgIGF4Y0Fzc2V0SURcclxuICAgICAgKVxyXG4gICAgICBldm1PdXRwdXRzLnB1c2goZXZtT3V0cHV0KVxyXG4gICAgICBldm1PdXRwdXQgPSBuZXcgRVZNT3V0cHV0KGNIZXhBZGRyZXNzMiwgT05FQVhDLmRpdihuZXcgQk4oMykpLCBheGNBc3NldElEKVxyXG4gICAgICBldm1PdXRwdXRzLnB1c2goZXZtT3V0cHV0KVxyXG5cclxuICAgICAgY29uc3QgaW1wb3J0VHg6IEltcG9ydFR4ID0gbmV3IEltcG9ydFR4KFxyXG4gICAgICAgIG5ldHdvcmtJRCxcclxuICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKGJsb2NrY2hhaW5JRCksXHJcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShzb3VyY2VjaGFpbklEKSxcclxuICAgICAgICBpbXBvcnRlZElucyxcclxuICAgICAgICBldm1PdXRwdXRzXHJcbiAgICAgIClcclxuICAgICAgZXhwZWN0KGltcG9ydFR4KS50b0JlSW5zdGFuY2VPZihJbXBvcnRUeClcclxuICAgICAgZXhwZWN0KGltcG9ydFR4LmdldFNvdXJjZUNoYWluKCkudG9TdHJpbmcoXCJoZXhcIikpLnRvQmUoXHJcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShzb3VyY2VjaGFpbklEKS50b1N0cmluZyhcImhleFwiKVxyXG4gICAgICApXHJcbiAgICB9KVxyXG5cclxuICAgIHRlc3QoXCJNdWx0aXBsZSBBTlQgRVZNT3V0cHV0IGZhaWxcIiwgKCk6IHZvaWQgPT4ge1xyXG4gICAgICBjb25zdCBvdXRwdXRpZHg6IEJ1ZmZlciA9IEJ1ZmZlci5mcm9tKFwiXCIpXHJcbiAgICAgIGNvbnN0IGlucHV0OiBTRUNQVHJhbnNmZXJJbnB1dCA9IG5ldyBTRUNQVHJhbnNmZXJJbnB1dChuZXcgQk4oNTA3KSlcclxuICAgICAgY29uc3QgeGZlcmluOiBUcmFuc2ZlcmFibGVJbnB1dCA9IG5ldyBUcmFuc2ZlcmFibGVJbnB1dChcclxuICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKHR4SUQpLFxyXG4gICAgICAgIG91dHB1dGlkeCxcclxuICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKGF4Y0Fzc2V0SUQpLFxyXG4gICAgICAgIGlucHV0XHJcbiAgICAgIClcclxuICAgICAgaW1wb3J0ZWRJbnMucHVzaCh4ZmVyaW4pXHJcbiAgICAgIC8vIENyZWF0aW5nIDIgb3V0cHV0cyB3aXRoIHRoZSBzYW1lIGFkZHJlc3MgYW5kIEFOVCBhc3NldElEIGlzIGludmFsaWRcclxuICAgICAgbGV0IGV2bU91dHB1dDogRVZNT3V0cHV0ID0gbmV3IEVWTU91dHB1dChjSGV4QWRkcmVzczEsIE9ORUFYQywgYW50QXNzZXRJRClcclxuICAgICAgZXZtT3V0cHV0cy5wdXNoKGV2bU91dHB1dClcclxuICAgICAgZXZtT3V0cHV0ID0gbmV3IEVWTU91dHB1dChjSGV4QWRkcmVzczEsIE9ORUFYQywgYW50QXNzZXRJRClcclxuICAgICAgZXZtT3V0cHV0cy5wdXNoKGV2bU91dHB1dClcclxuICAgICAgZXhwZWN0KCgpOiB2b2lkID0+IHtcclxuICAgICAgICBuZXcgSW1wb3J0VHgoXHJcbiAgICAgICAgICBuZXR3b3JrSUQsXHJcbiAgICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKGJsb2NrY2hhaW5JRCksXHJcbiAgICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKHNvdXJjZWNoYWluSUQpLFxyXG4gICAgICAgICAgaW1wb3J0ZWRJbnMsXHJcbiAgICAgICAgICBldm1PdXRwdXRzXHJcbiAgICAgICAgKVxyXG4gICAgICB9KS50b1Rocm93KFxyXG4gICAgICAgIFwiRXJyb3IgLSBJbXBvcnRUeDogZHVwbGljYXRlIChhZGRyZXNzLCBhc3NldElkKSBwYWlyIGZvdW5kIGluIG91dHB1dHM6ICgweDhkYjk3YzdjZWNlMjQ5YzJiOThiZGMwMjI2Y2M0YzJhNTdiZjUyZmMsIEY0TXlKY1V2cTNSeGJxZ2Q0WnM4c1VwdndMSEFweXJwNHl4SlhlMmJBVjg2VnZwMzgpXCJcclxuICAgICAgKVxyXG4gICAgfSlcclxuXHJcbiAgICB0ZXN0KFwiTXVsdGlwbGUgQU5UIEVWTU91dHB1dCBzdWNjZXNzXCIsICgpOiB2b2lkID0+IHtcclxuICAgICAgY29uc3Qgb3V0cHV0aWR4OiBCdWZmZXIgPSBCdWZmZXIuZnJvbShcIlwiKVxyXG4gICAgICBjb25zdCBpbnB1dDogU0VDUFRyYW5zZmVySW5wdXQgPSBuZXcgU0VDUFRyYW5zZmVySW5wdXQoZmVlKVxyXG4gICAgICBjb25zdCB4ZmVyaW46IFRyYW5zZmVyYWJsZUlucHV0ID0gbmV3IFRyYW5zZmVyYWJsZUlucHV0KFxyXG4gICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUodHhJRCksXHJcbiAgICAgICAgb3V0cHV0aWR4LFxyXG4gICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUoYXhjQXNzZXRJRCksXHJcbiAgICAgICAgaW5wdXRcclxuICAgICAgKVxyXG4gICAgICBpbXBvcnRlZElucy5wdXNoKHhmZXJpbilcclxuICAgICAgbGV0IGV2bU91dHB1dDogRVZNT3V0cHV0ID0gbmV3IEVWTU91dHB1dChjSGV4QWRkcmVzczEsIE9ORUFYQywgYW50QXNzZXRJRClcclxuICAgICAgZXZtT3V0cHV0cy5wdXNoKGV2bU91dHB1dClcclxuICAgICAgZXZtT3V0cHV0ID0gbmV3IEVWTU91dHB1dChjSGV4QWRkcmVzczIsIE9ORUFYQywgYW50QXNzZXRJRClcclxuICAgICAgZXZtT3V0cHV0cy5wdXNoKGV2bU91dHB1dClcclxuXHJcbiAgICAgIGNvbnN0IGltcG9ydFR4OiBJbXBvcnRUeCA9IG5ldyBJbXBvcnRUeChcclxuICAgICAgICBuZXR3b3JrSUQsXHJcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShibG9ja2NoYWluSUQpLFxyXG4gICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUoc291cmNlY2hhaW5JRCksXHJcbiAgICAgICAgaW1wb3J0ZWRJbnMsXHJcbiAgICAgICAgZXZtT3V0cHV0c1xyXG4gICAgICApXHJcbiAgICAgIGV4cGVjdChpbXBvcnRUeCkudG9CZUluc3RhbmNlT2YoSW1wb3J0VHgpXHJcbiAgICB9KVxyXG5cclxuICAgIHRlc3QoXCJTaW5nbGUgQU5UIEVWTU91dHB1dCBmYWlsXCIsICgpOiB2b2lkID0+IHtcclxuICAgICAgY29uc3Qgb3V0cHV0aWR4OiBCdWZmZXIgPSBCdWZmZXIuZnJvbShcIlwiKVxyXG4gICAgICBjb25zdCBpbnB1dDogU0VDUFRyYW5zZmVySW5wdXQgPSBuZXcgU0VDUFRyYW5zZmVySW5wdXQobmV3IEJOKDApKVxyXG4gICAgICBjb25zdCB4ZmVyaW46IFRyYW5zZmVyYWJsZUlucHV0ID0gbmV3IFRyYW5zZmVyYWJsZUlucHV0KFxyXG4gICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUodHhJRCksXHJcbiAgICAgICAgb3V0cHV0aWR4LFxyXG4gICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUoYXhjQXNzZXRJRCksXHJcbiAgICAgICAgaW5wdXRcclxuICAgICAgKVxyXG4gICAgICBpbXBvcnRlZElucy5wdXNoKHhmZXJpbilcclxuXHJcbiAgICAgIC8vIElmIHRoZSBvdXRwdXQgaXMgYSBub24tYXhjIGFzc2V0SUQgdGhlbiBkb24ndCBzdWJ0cmFjdCBhIGZlZVxyXG4gICAgICBjb25zdCBldm1PdXRwdXQ6IEVWTU91dHB1dCA9IG5ldyBFVk1PdXRwdXQoXHJcbiAgICAgICAgY0hleEFkZHJlc3MxLFxyXG4gICAgICAgIE9ORUFYQyxcclxuICAgICAgICBhbnRBc3NldElEXHJcbiAgICAgIClcclxuICAgICAgZXZtT3V0cHV0cy5wdXNoKGV2bU91dHB1dClcclxuICAgICAgY29uc3QgYmFzZUZlZTogQk4gPSBuZXcgQk4oMjUwMDAwMDAwMDApXHJcbiAgICAgIGV4cGVjdCgoKTogdm9pZCA9PiB7XHJcbiAgICAgICAgbmV3IEltcG9ydFR4KFxyXG4gICAgICAgICAgbmV0d29ya0lELFxyXG4gICAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShibG9ja2NoYWluSUQpLFxyXG4gICAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShzb3VyY2VjaGFpbklEKSxcclxuICAgICAgICAgIGltcG9ydGVkSW5zLFxyXG4gICAgICAgICAgZXZtT3V0cHV0cyxcclxuICAgICAgICAgIGJhc2VGZWVcclxuICAgICAgICApXHJcbiAgICAgIH0pLnRvVGhyb3coXHJcbiAgICAgICAgXCJFcnJvciAtIDI1MDAwMDAwMDAwIG5BWEMgcmVxdWlyZWQgZm9yIGZlZSBhbmQgb25seSAwIG5BWEMgcHJvdmlkZWRcIlxyXG4gICAgICApXHJcbiAgICB9KVxyXG5cclxuICAgIHRlc3QoXCJTaW5nbGUgQU5UIEVWTU91dHB1dCBzdWNjZXNzXCIsICgpOiB2b2lkID0+IHtcclxuICAgICAgY29uc3Qgb3V0cHV0aWR4OiBCdWZmZXIgPSBCdWZmZXIuZnJvbShcIlwiKVxyXG4gICAgICBjb25zdCBpbnB1dDogU0VDUFRyYW5zZmVySW5wdXQgPSBuZXcgU0VDUFRyYW5zZmVySW5wdXQoT05FQVhDKVxyXG4gICAgICBjb25zdCB4ZmVyaW46IFRyYW5zZmVyYWJsZUlucHV0ID0gbmV3IFRyYW5zZmVyYWJsZUlucHV0KFxyXG4gICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUodHhJRCksXHJcbiAgICAgICAgb3V0cHV0aWR4LFxyXG4gICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUoYXhjQXNzZXRJRCksXHJcbiAgICAgICAgaW5wdXRcclxuICAgICAgKVxyXG4gICAgICBpbXBvcnRlZElucy5wdXNoKHhmZXJpbilcclxuICAgICAgY29uc3QgZXZtT3V0cHV0OiBFVk1PdXRwdXQgPSBuZXcgRVZNT3V0cHV0KFxyXG4gICAgICAgIGNIZXhBZGRyZXNzMSxcclxuICAgICAgICBPTkVBWEMsXHJcbiAgICAgICAgYW50QXNzZXRJRFxyXG4gICAgICApXHJcbiAgICAgIGV2bU91dHB1dHMucHVzaChldm1PdXRwdXQpXHJcbiAgICAgIGNvbnN0IGltcG9ydFR4OiBJbXBvcnRUeCA9IG5ldyBJbXBvcnRUeChcclxuICAgICAgICBuZXR3b3JrSUQsXHJcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShibG9ja2NoYWluSUQpLFxyXG4gICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUoc291cmNlY2hhaW5JRCksXHJcbiAgICAgICAgaW1wb3J0ZWRJbnMsXHJcbiAgICAgICAgZXZtT3V0cHV0c1xyXG4gICAgICApXHJcbiAgICAgIGV4cGVjdChpbXBvcnRUeCkudG9CZUluc3RhbmNlT2YoSW1wb3J0VHgpXHJcbiAgICB9KVxyXG5cclxuICAgIHRlc3QoXCJTaW5nbGUgQVhDIEVWTU91dHB1dCBmYWlsXCIsICgpOiB2b2lkID0+IHtcclxuICAgICAgY29uc3Qgb3V0cHV0aWR4OiBCdWZmZXIgPSBCdWZmZXIuZnJvbShcIlwiKVxyXG4gICAgICBjb25zdCBpbnB1dDogU0VDUFRyYW5zZmVySW5wdXQgPSBuZXcgU0VDUFRyYW5zZmVySW5wdXQobmV3IEJOKDUwNykpXHJcbiAgICAgIGNvbnN0IHhmZXJpbjogVHJhbnNmZXJhYmxlSW5wdXQgPSBuZXcgVHJhbnNmZXJhYmxlSW5wdXQoXHJcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZSh0eElEKSxcclxuICAgICAgICBvdXRwdXRpZHgsXHJcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShheGNBc3NldElEKSxcclxuICAgICAgICBpbnB1dFxyXG4gICAgICApXHJcbiAgICAgIGltcG9ydGVkSW5zLnB1c2goeGZlcmluKVxyXG5cclxuICAgICAgY29uc3QgZXZtT3V0cHV0OiBFVk1PdXRwdXQgPSBuZXcgRVZNT3V0cHV0KFxyXG4gICAgICAgIGNIZXhBZGRyZXNzMSxcclxuICAgICAgICBuZXcgQk4oMCksXHJcbiAgICAgICAgYXhjQXNzZXRJRFxyXG4gICAgICApXHJcbiAgICAgIGV2bU91dHB1dHMucHVzaChldm1PdXRwdXQpXHJcbiAgICAgIGNvbnN0IGJhc2VGZWU6IEJOID0gbmV3IEJOKDI1MDAwMDAwMDAwKVxyXG4gICAgICBleHBlY3QoKCk6IHZvaWQgPT4ge1xyXG4gICAgICAgIG5ldyBJbXBvcnRUeChcclxuICAgICAgICAgIG5ldHdvcmtJRCxcclxuICAgICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUoYmxvY2tjaGFpbklEKSxcclxuICAgICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUoc291cmNlY2hhaW5JRCksXHJcbiAgICAgICAgICBpbXBvcnRlZElucyxcclxuICAgICAgICAgIGV2bU91dHB1dHMsXHJcbiAgICAgICAgICBiYXNlRmVlXHJcbiAgICAgICAgKVxyXG4gICAgICB9KS50b1Rocm93KFxyXG4gICAgICAgIFwiRXJyb3IgLSAyNTAwMDAwMDAwMCBuQVhDIHJlcXVpcmVkIGZvciBmZWUgYW5kIG9ubHkgNTA3IG5BWEMgcHJvdmlkZWRcIlxyXG4gICAgICApXHJcbiAgICB9KVxyXG5cclxuICAgIHRlc3QoXCJTaW5nbGUgQVhDIEVWTU91dHB1dCBzdWNjZXNzXCIsICgpOiB2b2lkID0+IHtcclxuICAgICAgY29uc3Qgb3V0cHV0aWR4OiBCdWZmZXIgPSBCdWZmZXIuZnJvbShcIlwiKVxyXG4gICAgICBjb25zdCBpbnB1dDogU0VDUFRyYW5zZmVySW5wdXQgPSBuZXcgU0VDUFRyYW5zZmVySW5wdXQoT05FQVhDKVxyXG4gICAgICBjb25zdCB4ZmVyaW46IFRyYW5zZmVyYWJsZUlucHV0ID0gbmV3IFRyYW5zZmVyYWJsZUlucHV0KFxyXG4gICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUodHhJRCksXHJcbiAgICAgICAgb3V0cHV0aWR4LFxyXG4gICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUoYXhjQXNzZXRJRCksXHJcbiAgICAgICAgaW5wdXRcclxuICAgICAgKVxyXG4gICAgICBpbXBvcnRlZElucy5wdXNoKHhmZXJpbilcclxuICAgICAgY29uc3QgZXZtT3V0cHV0OiBFVk1PdXRwdXQgPSBuZXcgRVZNT3V0cHV0KFxyXG4gICAgICAgIGNIZXhBZGRyZXNzMSxcclxuICAgICAgICBPTkVBWEMuc3ViKE1JTExJQVhDKSxcclxuICAgICAgICBheGNBc3NldElEXHJcbiAgICAgIClcclxuICAgICAgZXZtT3V0cHV0cy5wdXNoKGV2bU91dHB1dClcclxuICAgICAgY29uc3QgaW1wb3J0VHg6IEltcG9ydFR4ID0gbmV3IEltcG9ydFR4KFxyXG4gICAgICAgIG5ldHdvcmtJRCxcclxuICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKGJsb2NrY2hhaW5JRCksXHJcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShzb3VyY2VjaGFpbklEKSxcclxuICAgICAgICBpbXBvcnRlZElucyxcclxuICAgICAgICBldm1PdXRwdXRzXHJcbiAgICAgIClcclxuICAgICAgZXhwZWN0KGltcG9ydFR4KS50b0JlSW5zdGFuY2VPZihJbXBvcnRUeClcclxuICAgIH0pXHJcbiAgfSlcclxuICBkZXNjcmliZShcIkV4cG9ydFR4XCIsICgpID0+IHtcclxuICAgIHRlc3QoXCJnZXREZXN0aW5hdGlvbkNoYWluXCIsICgpOiB2b2lkID0+IHtcclxuICAgICAgY29uc3QgZXhwb3J0VHg6IEV4cG9ydFR4ID0gbmV3IEV4cG9ydFR4KFxyXG4gICAgICAgIG5ldHdvcmtJRCxcclxuICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKGJsb2NrY2hhaW5JRCksXHJcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShQbGF0Zm9ybUNoYWluSUQpXHJcbiAgICAgIClcclxuICAgICAgZXhwZWN0KGV4cG9ydFR4KS50b0JlSW5zdGFuY2VPZihFeHBvcnRUeClcclxuICAgICAgZXhwZWN0KGV4cG9ydFR4LmdldERlc3RpbmF0aW9uQ2hhaW4oKS50b1N0cmluZyhcImhleFwiKSkudG9CZShcclxuICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKFBsYXRmb3JtQ2hhaW5JRCkudG9TdHJpbmcoXCJoZXhcIilcclxuICAgICAgKVxyXG4gICAgfSlcclxuICB9KVxyXG59KVxyXG4iXX0=