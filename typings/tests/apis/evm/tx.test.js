"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const evm_1 = require("../../../src/apis/evm");
const constants_1 = require("../../../src/utils/constants");
const constants_2 = require("../../../src/utils/constants");
const evm_2 = require("../../../src/apis/evm");
const bn_js_1 = __importDefault(require("bn.js"));
const src_1 = require("src");
const networkID = 1337;
const cHexAddress1 = "0x8db97C7cEcE249c2b98bDC0226Cc4C2A57BF52FC";
const bintools = src_1.BinTools.getInstance();
const cHexAddress2 = "0xecC3B2968B277b837a81A7181e0b94EB1Ca54EdE";
const antAssetID = "F4MyJcUvq3Rxbqgd4Zs8sUpvwLHApyrp4yxJXe2bAV86Vvp38";
const axcAssetID = constants_1.Defaults.network[networkID].Swap.axcAssetID;
const txID = "QVb7DtKjcwVYLFWHgnGSdzQtQSc29KeRBYFNCBnbFu6dFqX7z";
const blockchainID = constants_1.Defaults.network[networkID].AX.blockchainID;
const sourcechainID = constants_1.Defaults.network[networkID].Swap.blockchainID;
let evmOutputs;
let importedIns;
const fee = constants_1.Defaults.network[networkID].AX.txFee;
beforeEach(() => {
    evmOutputs = [];
    importedIns = [];
});
describe("EVM Transactions", () => {
    describe("ImportTx", () => {
        test("Multiple AXC EVMOutput fail", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(constants_2.ONEAXC);
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(axcAssetID), input);
            importedIns.push(xferin);
            // Creating 2 outputs with the same address and AXC assetID is invalid
            let evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAXC, axcAssetID);
            evmOutputs.push(evmOutput);
            evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAXC, axcAssetID);
            evmOutputs.push(evmOutput);
            expect(() => {
                new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs);
            }).toThrow("Error - ImportTx: duplicate (address, assetId) pair found in outputs: (0x8db97c7cece249c2b98bdc0226cc4c2a57bf52fc, BUuypiq2wyuLMvyhzFXcPyxPMCgSp7eeDohhQRqTChoBjKziC)");
        });
        test("Multiple AXC EVMOutput success", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(constants_2.ONEAXC);
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(axcAssetID), input);
            importedIns.push(xferin);
            // Creating 2 outputs with different addresses valid
            let evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAXC.div(new bn_js_1.default(3)), axcAssetID);
            evmOutputs.push(evmOutput);
            evmOutput = new evm_2.EVMOutput(cHexAddress2, constants_2.ONEAXC.div(new bn_js_1.default(3)), axcAssetID);
            evmOutputs.push(evmOutput);
            const importTx = new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs);
            expect(importTx).toBeInstanceOf(evm_1.ImportTx);
            expect(importTx.getSourceChain().toString("hex")).toBe(bintools.cb58Decode(sourcechainID).toString("hex"));
        });
        test("Multiple ANT EVMOutput fail", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(new bn_js_1.default(507));
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(axcAssetID), input);
            importedIns.push(xferin);
            // Creating 2 outputs with the same address and ANT assetID is invalid
            let evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAXC, antAssetID);
            evmOutputs.push(evmOutput);
            evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAXC, antAssetID);
            evmOutputs.push(evmOutput);
            expect(() => {
                new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs);
            }).toThrow("Error - ImportTx: duplicate (address, assetId) pair found in outputs: (0x8db97c7cece249c2b98bdc0226cc4c2a57bf52fc, F4MyJcUvq3Rxbqgd4Zs8sUpvwLHApyrp4yxJXe2bAV86Vvp38)");
        });
        test("Multiple ANT EVMOutput success", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(fee);
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(axcAssetID), input);
            importedIns.push(xferin);
            let evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAXC, antAssetID);
            evmOutputs.push(evmOutput);
            evmOutput = new evm_2.EVMOutput(cHexAddress2, constants_2.ONEAXC, antAssetID);
            evmOutputs.push(evmOutput);
            const importTx = new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs);
            expect(importTx).toBeInstanceOf(evm_1.ImportTx);
        });
        test("Single ANT EVMOutput fail", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(new bn_js_1.default(0));
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(axcAssetID), input);
            importedIns.push(xferin);
            // If the output is a non-axc assetID then don't subtract a fee
            const evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAXC, antAssetID);
            evmOutputs.push(evmOutput);
            const baseFee = new bn_js_1.default(25000000000);
            expect(() => {
                new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs, baseFee);
            }).toThrow("Error - 25000000000 nAXC required for fee and only 0 nAXC provided");
        });
        test("Single ANT EVMOutput success", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(constants_2.ONEAXC);
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(axcAssetID), input);
            importedIns.push(xferin);
            const evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAXC, antAssetID);
            evmOutputs.push(evmOutput);
            const importTx = new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs);
            expect(importTx).toBeInstanceOf(evm_1.ImportTx);
        });
        test("Single AXC EVMOutput fail", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(new bn_js_1.default(507));
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(axcAssetID), input);
            importedIns.push(xferin);
            const evmOutput = new evm_2.EVMOutput(cHexAddress1, new bn_js_1.default(0), axcAssetID);
            evmOutputs.push(evmOutput);
            const baseFee = new bn_js_1.default(25000000000);
            expect(() => {
                new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs, baseFee);
            }).toThrow("Error - 25000000000 nAXC required for fee and only 507 nAXC provided");
        });
        test("Single AXC EVMOutput success", () => {
            const outputidx = src_1.Buffer.from("");
            const input = new evm_1.SECPTransferInput(constants_2.ONEAXC);
            const xferin = new evm_1.TransferableInput(bintools.cb58Decode(txID), outputidx, bintools.cb58Decode(axcAssetID), input);
            importedIns.push(xferin);
            const evmOutput = new evm_2.EVMOutput(cHexAddress1, constants_2.ONEAXC.sub(constants_1.MILLIAXC), axcAssetID);
            evmOutputs.push(evmOutput);
            const importTx = new evm_1.ImportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(sourcechainID), importedIns, evmOutputs);
            expect(importTx).toBeInstanceOf(evm_1.ImportTx);
        });
    });
    describe("ExportTx", () => {
        test("getDestinationChain", () => {
            const exportTx = new evm_1.ExportTx(networkID, bintools.cb58Decode(blockchainID), bintools.cb58Decode(constants_1.PlatformChainID));
            expect(exportTx).toBeInstanceOf(evm_1.ExportTx);
            expect(exportTx.getDestinationChain().toString("hex")).toBe(bintools.cb58Decode(constants_1.PlatformChainID).toString("hex"));
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHgudGVzdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Rlc3RzL2FwaXMvZXZtL3R4LnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSwrQ0FLOEI7QUFDOUIsNERBSXFDO0FBQ3JDLDREQUFxRDtBQUNyRCwrQ0FBaUQ7QUFDakQsa0RBQXNCO0FBQ3RCLDZCQUFzQztBQUN0QyxNQUFNLFNBQVMsR0FBVyxJQUFJLENBQUE7QUFDOUIsTUFBTSxZQUFZLEdBQVcsNENBQTRDLENBQUE7QUFDekUsTUFBTSxRQUFRLEdBQWEsY0FBUSxDQUFDLFdBQVcsRUFBRSxDQUFBO0FBQ2pELE1BQU0sWUFBWSxHQUFXLDRDQUE0QyxDQUFBO0FBQ3pFLE1BQU0sVUFBVSxHQUFXLG1EQUFtRCxDQUFBO0FBQzlFLE1BQU0sVUFBVSxHQUFXLG9CQUFRLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUE7QUFDdEUsTUFBTSxJQUFJLEdBQVcsbURBQW1ELENBQUE7QUFDeEUsTUFBTSxZQUFZLEdBQVcsb0JBQVEsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLFlBQVksQ0FBQTtBQUN4RSxNQUFNLGFBQWEsR0FBVyxvQkFBUSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFBO0FBQzNFLElBQUksVUFBdUIsQ0FBQTtBQUMzQixJQUFJLFdBQWdDLENBQUE7QUFDcEMsTUFBTSxHQUFHLEdBQU8sb0JBQVEsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQTtBQUVwRCxVQUFVLENBQUMsR0FBUyxFQUFFO0lBQ3BCLFVBQVUsR0FBRyxFQUFFLENBQUE7SUFDZixXQUFXLEdBQUcsRUFBRSxDQUFBO0FBQ2xCLENBQUMsQ0FBQyxDQUFBO0FBRUYsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFB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LEVBQUUsR0FBRyxFQUFFO1FBQ3hCLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxHQUFTLEVBQUU7WUFDckMsTUFBTSxRQUFRLEdBQWEsSUFBSSxjQUFRLENBQ3JDLFNBQVMsRUFDVCxRQUFRLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxFQUNqQyxRQUFRLENBQUMsVUFBVSxDQUFDLDJCQUFlLENBQUMsQ0FDckMsQ0FBQTtZQUNELE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxjQUFjLENBQUMsY0FBUSxDQUFDLENBQUE7WUFDekMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FDekQsUUFBUSxDQUFDLFVBQVUsQ0FBQywyQkFBZSxDQUFDLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUNyRCxDQUFBO1FBQ0gsQ0FBQyxDQUFDLENBQUE7SUFDSixDQUFDLENBQUMsQ0FBQTtBQUNKLENBQUMsQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRXhwb3J0VHgsXG4gIEltcG9ydFR4LFxuICBTRUNQVHJhbnNmZXJJbnB1dCxcbiAgVHJhbnNmZXJhYmxlSW5wdXRcbn0gZnJvbSBcIi4uLy4uLy4uL3NyYy9hcGlzL2V2bVwiXG5pbXBvcnQge1xuICBEZWZhdWx0cyxcbiAgTUlMTElBWEMsXG4gIFBsYXRmb3JtQ2hhaW5JRFxufSBmcm9tIFwiLi4vLi4vLi4vc3JjL3V0aWxzL2NvbnN0YW50c1wiXG5pbXBvcnQgeyBPTkVBWEMgfSBmcm9tIFwiLi4vLi4vLi4vc3JjL3V0aWxzL2NvbnN0YW50c1wiXG5pbXBvcnQgeyBFVk1PdXRwdXQgfSBmcm9tIFwiLi4vLi4vLi4vc3JjL2FwaXMvZXZtXCJcbmltcG9ydCBCTiBmcm9tIFwiYm4uanNcIlxuaW1wb3J0IHsgQmluVG9vbHMsIEJ1ZmZlciB9IGZyb20gXCJzcmNcIlxuY29uc3QgbmV0d29ya0lEOiBudW1iZXIgPSAxMzM3XG5jb25zdCBjSGV4QWRkcmVzczE6IHN0cmluZyA9IFwiMHg4ZGI5N0M3Y0VjRTI0OWMyYjk4YkRDMDIyNkNjNEMyQTU3QkY1MkZDXCJcbmNvbnN0IGJpbnRvb2xzOiBCaW5Ub29scyA9IEJpblRvb2xzLmdldEluc3RhbmNlKClcbmNvbnN0IGNIZXhBZGRyZXNzMjogc3RyaW5nID0gXCIweGVjQzNCMjk2OEIyNzdiODM3YTgxQTcxODFlMGI5NEVCMUNhNTRFZEVcIlxuY29uc3QgYW50QXNzZXRJRDogc3RyaW5nID0gXCJGNE15SmNVdnEzUnhicWdkNFpzOHNVcHZ3TEhBcHlycDR5eEpYZTJiQVY4NlZ2cDM4XCJcbmNvbnN0IGF4Y0Fzc2V0SUQ6IHN0cmluZyA9IERlZmF1bHRzLm5ldHdvcmtbbmV0d29ya0lEXS5Td2FwLmF4Y0Fzc2V0SURcbmNvbnN0IHR4SUQ6IHN0cmluZyA9IFwiUVZiN0R0S2pjd1ZZTEZXSGduR1NkelF0UVNjMjlLZVJCWUZOQ0JuYkZ1NmRGcVg3elwiXG5jb25zdCBibG9ja2NoYWluSUQ6IHN0cmluZyA9IERlZmF1bHRzLm5ldHdvcmtbbmV0d29ya0lEXS5BWC5ibG9ja2NoYWluSURcbmNvbnN0IHNvdXJjZWNoYWluSUQ6IHN0cmluZyA9IERlZmF1bHRzLm5ldHdvcmtbbmV0d29ya0lEXS5Td2FwLmJsb2NrY2hhaW5JRFxubGV0IGV2bU91dHB1dHM6IEVWTU91dHB1dFtdXG5sZXQgaW1wb3J0ZWRJbnM6IFRyYW5zZmVyYWJsZUlucHV0W11cbmNvbnN0IGZlZTogQk4gPSBEZWZhdWx0cy5uZXR3b3JrW25ldHdvcmtJRF0uQVgudHhGZWVcblxuYmVmb3JlRWFjaCgoKTogdm9pZCA9PiB7XG4gIGV2bU91dHB1dHMgPSBbXVxuICBpbXBvcnRlZElucyA9IFtdXG59KVxuXG5kZXNjcmliZShcIkVWTSBUcmFuc2FjdGlvbnNcIiwgKCkgPT4ge1xuICBkZXNjcmliZShcIkltcG9ydFR4XCIsICgpID0+IHtcbiAgICB0ZXN0KFwiTXVsdGlwbGUgQVhDIEVWTU91dHB1dCBmYWlsXCIsICgpOiB2b2lkID0+IHtcbiAgICAgIGNvbnN0IG91dHB1dGlkeDogQnVmZmVyID0gQnVmZmVyLmZyb20oXCJcIilcbiAgICAgIGNvbnN0IGlucHV0OiBTRUNQVHJhbnNmZXJJbnB1dCA9IG5ldyBTRUNQVHJhbnNmZXJJbnB1dChPTkVBWEMpXG4gICAgICBjb25zdCB4ZmVyaW46IFRyYW5zZmVyYWJsZUlucHV0ID0gbmV3IFRyYW5zZmVyYWJsZUlucHV0KFxuICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKHR4SUQpLFxuICAgICAgICBvdXRwdXRpZHgsXG4gICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUoYXhjQXNzZXRJRCksXG4gICAgICAgIGlucHV0XG4gICAgICApXG4gICAgICBpbXBvcnRlZElucy5wdXNoKHhmZXJpbilcbiAgICAgIC8vIENyZWF0aW5nIDIgb3V0cHV0cyB3aXRoIHRoZSBzYW1lIGFkZHJlc3MgYW5kIEFYQyBhc3NldElEIGlzIGludmFsaWRcbiAgICAgIGxldCBldm1PdXRwdXQ6IEVWTU91dHB1dCA9IG5ldyBFVk1PdXRwdXQoY0hleEFkZHJlc3MxLCBPTkVBWEMsIGF4Y0Fzc2V0SUQpXG4gICAgICBldm1PdXRwdXRzLnB1c2goZXZtT3V0cHV0KVxuICAgICAgZXZtT3V0cHV0ID0gbmV3IEVWTU91dHB1dChjSGV4QWRkcmVzczEsIE9ORUFYQywgYXhjQXNzZXRJRClcbiAgICAgIGV2bU91dHB1dHMucHVzaChldm1PdXRwdXQpXG5cbiAgICAgIGV4cGVjdCgoKTogdm9pZCA9PiB7XG4gICAgICAgIG5ldyBJbXBvcnRUeChcbiAgICAgICAgICBuZXR3b3JrSUQsXG4gICAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShibG9ja2NoYWluSUQpLFxuICAgICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUoc291cmNlY2hhaW5JRCksXG4gICAgICAgICAgaW1wb3J0ZWRJbnMsXG4gICAgICAgICAgZXZtT3V0cHV0c1xuICAgICAgICApXG4gICAgICB9KS50b1Rocm93KFxuICAgICAgICBcIkVycm9yIC0gSW1wb3J0VHg6IGR1cGxpY2F0ZSAoYWRkcmVzcywgYXNzZXRJZCkgcGFpciBmb3VuZCBpbiBvdXRwdXRzOiAoMHg4ZGI5N2M3Y2VjZTI0OWMyYjk4YmRjMDIyNmNjNGMyYTU3YmY1MmZjLCBCVXV5cGlxMnd5dUxNdnloekZYY1B5eFBNQ2dTcDdlZURvaGhRUnFUQ2hvQmpLemlDKVwiXG4gICAgICApXG4gICAgfSlcblxuICAgIHRlc3QoXCJNdWx0aXBsZSBBWEMgRVZNT3V0cHV0IHN1Y2Nlc3NcIiwgKCk6IHZvaWQgPT4ge1xuICAgICAgY29uc3Qgb3V0cHV0aWR4OiBCdWZmZXIgPSBCdWZmZXIuZnJvbShcIlwiKVxuICAgICAgY29uc3QgaW5wdXQ6IFNFQ1BUcmFuc2ZlcklucHV0ID0gbmV3IFNFQ1BUcmFuc2ZlcklucHV0KE9ORUFYQylcbiAgICAgIGNvbnN0IHhmZXJpbjogVHJhbnNmZXJhYmxlSW5wdXQgPSBuZXcgVHJhbnNmZXJhYmxlSW5wdXQoXG4gICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUodHhJRCksXG4gICAgICAgIG91dHB1dGlkeCxcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShheGNBc3NldElEKSxcbiAgICAgICAgaW5wdXRcbiAgICAgIClcbiAgICAgIGltcG9ydGVkSW5zLnB1c2goeGZlcmluKVxuICAgICAgLy8gQ3JlYXRpbmcgMiBvdXRwdXRzIHdpdGggZGlmZmVyZW50IGFkZHJlc3NlcyB2YWxpZFxuICAgICAgbGV0IGV2bU91dHB1dDogRVZNT3V0cHV0ID0gbmV3IEVWTU91dHB1dChcbiAgICAgICAgY0hleEFkZHJlc3MxLFxuICAgICAgICBPTkVBWEMuZGl2KG5ldyBCTigzKSksXG4gICAgICAgIGF4Y0Fzc2V0SURcbiAgICAgIClcbiAgICAgIGV2bU91dHB1dHMucHVzaChldm1PdXRwdXQpXG4gICAgICBldm1PdXRwdXQgPSBuZXcgRVZNT3V0cHV0KGNIZXhBZGRyZXNzMiwgT05FQVhDLmRpdihuZXcgQk4oMykpLCBheGNBc3NldElEKVxuICAgICAgZXZtT3V0cHV0cy5wdXNoKGV2bU91dHB1dClcblxuICAgICAgY29uc3QgaW1wb3J0VHg6IEltcG9ydFR4ID0gbmV3IEltcG9ydFR4KFxuICAgICAgICBuZXR3b3JrSUQsXG4gICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUoYmxvY2tjaGFpbklEKSxcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShzb3VyY2VjaGFpbklEKSxcbiAgICAgICAgaW1wb3J0ZWRJbnMsXG4gICAgICAgIGV2bU91dHB1dHNcbiAgICAgIClcbiAgICAgIGV4cGVjdChpbXBvcnRUeCkudG9CZUluc3RhbmNlT2YoSW1wb3J0VHgpXG4gICAgICBleHBlY3QoaW1wb3J0VHguZ2V0U291cmNlQ2hhaW4oKS50b1N0cmluZyhcImhleFwiKSkudG9CZShcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShzb3VyY2VjaGFpbklEKS50b1N0cmluZyhcImhleFwiKVxuICAgICAgKVxuICAgIH0pXG5cbiAgICB0ZXN0KFwiTXVsdGlwbGUgQU5UIEVWTU91dHB1dCBmYWlsXCIsICgpOiB2b2lkID0+IHtcbiAgICAgIGNvbnN0IG91dHB1dGlkeDogQnVmZmVyID0gQnVmZmVyLmZyb20oXCJcIilcbiAgICAgIGNvbnN0IGlucHV0OiBTRUNQVHJhbnNmZXJJbnB1dCA9IG5ldyBTRUNQVHJhbnNmZXJJbnB1dChuZXcgQk4oNTA3KSlcbiAgICAgIGNvbnN0IHhmZXJpbjogVHJhbnNmZXJhYmxlSW5wdXQgPSBuZXcgVHJhbnNmZXJhYmxlSW5wdXQoXG4gICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUodHhJRCksXG4gICAgICAgIG91dHB1dGlkeCxcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShheGNBc3NldElEKSxcbiAgICAgICAgaW5wdXRcbiAgICAgIClcbiAgICAgIGltcG9ydGVkSW5zLnB1c2goeGZlcmluKVxuICAgICAgLy8gQ3JlYXRpbmcgMiBvdXRwdXRzIHdpdGggdGhlIHNhbWUgYWRkcmVzcyBhbmQgQU5UIGFzc2V0SUQgaXMgaW52YWxpZFxuICAgICAgbGV0IGV2bU91dHB1dDogRVZNT3V0cHV0ID0gbmV3IEVWTU91dHB1dChjSGV4QWRkcmVzczEsIE9ORUFYQywgYW50QXNzZXRJRClcbiAgICAgIGV2bU91dHB1dHMucHVzaChldm1PdXRwdXQpXG4gICAgICBldm1PdXRwdXQgPSBuZXcgRVZNT3V0cHV0KGNIZXhBZGRyZXNzMSwgT05FQVhDLCBhbnRBc3NldElEKVxuICAgICAgZXZtT3V0cHV0cy5wdXNoKGV2bU91dHB1dClcbiAgICAgIGV4cGVjdCgoKTogdm9pZCA9PiB7XG4gICAgICAgIG5ldyBJbXBvcnRUeChcbiAgICAgICAgICBuZXR3b3JrSUQsXG4gICAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShibG9ja2NoYWluSUQpLFxuICAgICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUoc291cmNlY2hhaW5JRCksXG4gICAgICAgICAgaW1wb3J0ZWRJbnMsXG4gICAgICAgICAgZXZtT3V0cHV0c1xuICAgICAgICApXG4gICAgICB9KS50b1Rocm93KFxuICAgICAgICBcIkVycm9yIC0gSW1wb3J0VHg6IGR1cGxpY2F0ZSAoYWRkcmVzcywgYXNzZXRJZCkgcGFpciBmb3VuZCBpbiBvdXRwdXRzOiAoMHg4ZGI5N2M3Y2VjZTI0OWMyYjk4YmRjMDIyNmNjNGMyYTU3YmY1MmZjLCBGNE15SmNVdnEzUnhicWdkNFpzOHNVcHZ3TEhBcHlycDR5eEpYZTJiQVY4NlZ2cDM4KVwiXG4gICAgICApXG4gICAgfSlcblxuICAgIHRlc3QoXCJNdWx0aXBsZSBBTlQgRVZNT3V0cHV0IHN1Y2Nlc3NcIiwgKCk6IHZvaWQgPT4ge1xuICAgICAgY29uc3Qgb3V0cHV0aWR4OiBCdWZmZXIgPSBCdWZmZXIuZnJvbShcIlwiKVxuICAgICAgY29uc3QgaW5wdXQ6IFNFQ1BUcmFuc2ZlcklucHV0ID0gbmV3IFNFQ1BUcmFuc2ZlcklucHV0KGZlZSlcbiAgICAgIGNvbnN0IHhmZXJpbjogVHJhbnNmZXJhYmxlSW5wdXQgPSBuZXcgVHJhbnNmZXJhYmxlSW5wdXQoXG4gICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUodHhJRCksXG4gICAgICAgIG91dHB1dGlkeCxcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShheGNBc3NldElEKSxcbiAgICAgICAgaW5wdXRcbiAgICAgIClcbiAgICAgIGltcG9ydGVkSW5zLnB1c2goeGZlcmluKVxuICAgICAgbGV0IGV2bU91dHB1dDogRVZNT3V0cHV0ID0gbmV3IEVWTU91dHB1dChjSGV4QWRkcmVzczEsIE9ORUFYQywgYW50QXNzZXRJRClcbiAgICAgIGV2bU91dHB1dHMucHVzaChldm1PdXRwdXQpXG4gICAgICBldm1PdXRwdXQgPSBuZXcgRVZNT3V0cHV0KGNIZXhBZGRyZXNzMiwgT05FQVhDLCBhbnRBc3NldElEKVxuICAgICAgZXZtT3V0cHV0cy5wdXNoKGV2bU91dHB1dClcblxuICAgICAgY29uc3QgaW1wb3J0VHg6IEltcG9ydFR4ID0gbmV3IEltcG9ydFR4KFxuICAgICAgICBuZXR3b3JrSUQsXG4gICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUoYmxvY2tjaGFpbklEKSxcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShzb3VyY2VjaGFpbklEKSxcbiAgICAgICAgaW1wb3J0ZWRJbnMsXG4gICAgICAgIGV2bU91dHB1dHNcbiAgICAgIClcbiAgICAgIGV4cGVjdChpbXBvcnRUeCkudG9CZUluc3RhbmNlT2YoSW1wb3J0VHgpXG4gICAgfSlcblxuICAgIHRlc3QoXCJTaW5nbGUgQU5UIEVWTU91dHB1dCBmYWlsXCIsICgpOiB2b2lkID0+IHtcbiAgICAgIGNvbnN0IG91dHB1dGlkeDogQnVmZmVyID0gQnVmZmVyLmZyb20oXCJcIilcbiAgICAgIGNvbnN0IGlucHV0OiBTRUNQVHJhbnNmZXJJbnB1dCA9IG5ldyBTRUNQVHJhbnNmZXJJbnB1dChuZXcgQk4oMCkpXG4gICAgICBjb25zdCB4ZmVyaW46IFRyYW5zZmVyYWJsZUlucHV0ID0gbmV3IFRyYW5zZmVyYWJsZUlucHV0KFxuICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKHR4SUQpLFxuICAgICAgICBvdXRwdXRpZHgsXG4gICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUoYXhjQXNzZXRJRCksXG4gICAgICAgIGlucHV0XG4gICAgICApXG4gICAgICBpbXBvcnRlZElucy5wdXNoKHhmZXJpbilcblxuICAgICAgLy8gSWYgdGhlIG91dHB1dCBpcyBhIG5vbi1heGMgYXNzZXRJRCB0aGVuIGRvbid0IHN1YnRyYWN0IGEgZmVlXG4gICAgICBjb25zdCBldm1PdXRwdXQ6IEVWTU91dHB1dCA9IG5ldyBFVk1PdXRwdXQoXG4gICAgICAgIGNIZXhBZGRyZXNzMSxcbiAgICAgICAgT05FQVhDLFxuICAgICAgICBhbnRBc3NldElEXG4gICAgICApXG4gICAgICBldm1PdXRwdXRzLnB1c2goZXZtT3V0cHV0KVxuICAgICAgY29uc3QgYmFzZUZlZTogQk4gPSBuZXcgQk4oMjUwMDAwMDAwMDApXG4gICAgICBleHBlY3QoKCk6IHZvaWQgPT4ge1xuICAgICAgICBuZXcgSW1wb3J0VHgoXG4gICAgICAgICAgbmV0d29ya0lELFxuICAgICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUoYmxvY2tjaGFpbklEKSxcbiAgICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKHNvdXJjZWNoYWluSUQpLFxuICAgICAgICAgIGltcG9ydGVkSW5zLFxuICAgICAgICAgIGV2bU91dHB1dHMsXG4gICAgICAgICAgYmFzZUZlZVxuICAgICAgICApXG4gICAgICB9KS50b1Rocm93KFxuICAgICAgICBcIkVycm9yIC0gMjUwMDAwMDAwMDAgbkFYQyByZXF1aXJlZCBmb3IgZmVlIGFuZCBvbmx5IDAgbkFYQyBwcm92aWRlZFwiXG4gICAgICApXG4gICAgfSlcblxuICAgIHRlc3QoXCJTaW5nbGUgQU5UIEVWTU91dHB1dCBzdWNjZXNzXCIsICgpOiB2b2lkID0+IHtcbiAgICAgIGNvbnN0IG91dHB1dGlkeDogQnVmZmVyID0gQnVmZmVyLmZyb20oXCJcIilcbiAgICAgIGNvbnN0IGlucHV0OiBTRUNQVHJhbnNmZXJJbnB1dCA9IG5ldyBTRUNQVHJhbnNmZXJJbnB1dChPTkVBWEMpXG4gICAgICBjb25zdCB4ZmVyaW46IFRyYW5zZmVyYWJsZUlucHV0ID0gbmV3IFRyYW5zZmVyYWJsZUlucHV0KFxuICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKHR4SUQpLFxuICAgICAgICBvdXRwdXRpZHgsXG4gICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUoYXhjQXNzZXRJRCksXG4gICAgICAgIGlucHV0XG4gICAgICApXG4gICAgICBpbXBvcnRlZElucy5wdXNoKHhmZXJpbilcbiAgICAgIGNvbnN0IGV2bU91dHB1dDogRVZNT3V0cHV0ID0gbmV3IEVWTU91dHB1dChcbiAgICAgICAgY0hleEFkZHJlc3MxLFxuICAgICAgICBPTkVBWEMsXG4gICAgICAgIGFudEFzc2V0SURcbiAgICAgIClcbiAgICAgIGV2bU91dHB1dHMucHVzaChldm1PdXRwdXQpXG4gICAgICBjb25zdCBpbXBvcnRUeDogSW1wb3J0VHggPSBuZXcgSW1wb3J0VHgoXG4gICAgICAgIG5ldHdvcmtJRCxcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShibG9ja2NoYWluSUQpLFxuICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKHNvdXJjZWNoYWluSUQpLFxuICAgICAgICBpbXBvcnRlZElucyxcbiAgICAgICAgZXZtT3V0cHV0c1xuICAgICAgKVxuICAgICAgZXhwZWN0KGltcG9ydFR4KS50b0JlSW5zdGFuY2VPZihJbXBvcnRUeClcbiAgICB9KVxuXG4gICAgdGVzdChcIlNpbmdsZSBBWEMgRVZNT3V0cHV0IGZhaWxcIiwgKCk6IHZvaWQgPT4ge1xuICAgICAgY29uc3Qgb3V0cHV0aWR4OiBCdWZmZXIgPSBCdWZmZXIuZnJvbShcIlwiKVxuICAgICAgY29uc3QgaW5wdXQ6IFNFQ1BUcmFuc2ZlcklucHV0ID0gbmV3IFNFQ1BUcmFuc2ZlcklucHV0KG5ldyBCTig1MDcpKVxuICAgICAgY29uc3QgeGZlcmluOiBUcmFuc2ZlcmFibGVJbnB1dCA9IG5ldyBUcmFuc2ZlcmFibGVJbnB1dChcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZSh0eElEKSxcbiAgICAgICAgb3V0cHV0aWR4LFxuICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKGF4Y0Fzc2V0SUQpLFxuICAgICAgICBpbnB1dFxuICAgICAgKVxuICAgICAgaW1wb3J0ZWRJbnMucHVzaCh4ZmVyaW4pXG5cbiAgICAgIGNvbnN0IGV2bU91dHB1dDogRVZNT3V0cHV0ID0gbmV3IEVWTU91dHB1dChcbiAgICAgICAgY0hleEFkZHJlc3MxLFxuICAgICAgICBuZXcgQk4oMCksXG4gICAgICAgIGF4Y0Fzc2V0SURcbiAgICAgIClcbiAgICAgIGV2bU91dHB1dHMucHVzaChldm1PdXRwdXQpXG4gICAgICBjb25zdCBiYXNlRmVlOiBCTiA9IG5ldyBCTigyNTAwMDAwMDAwMClcbiAgICAgIGV4cGVjdCgoKTogdm9pZCA9PiB7XG4gICAgICAgIG5ldyBJbXBvcnRUeChcbiAgICAgICAgICBuZXR3b3JrSUQsXG4gICAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShibG9ja2NoYWluSUQpLFxuICAgICAgICAgIGJpbnRvb2xzLmNiNThEZWNvZGUoc291cmNlY2hhaW5JRCksXG4gICAgICAgICAgaW1wb3J0ZWRJbnMsXG4gICAgICAgICAgZXZtT3V0cHV0cyxcbiAgICAgICAgICBiYXNlRmVlXG4gICAgICAgIClcbiAgICAgIH0pLnRvVGhyb3coXG4gICAgICAgIFwiRXJyb3IgLSAyNTAwMDAwMDAwMCBuQVhDIHJlcXVpcmVkIGZvciBmZWUgYW5kIG9ubHkgNTA3IG5BWEMgcHJvdmlkZWRcIlxuICAgICAgKVxuICAgIH0pXG5cbiAgICB0ZXN0KFwiU2luZ2xlIEFYQyBFVk1PdXRwdXQgc3VjY2Vzc1wiLCAoKTogdm9pZCA9PiB7XG4gICAgICBjb25zdCBvdXRwdXRpZHg6IEJ1ZmZlciA9IEJ1ZmZlci5mcm9tKFwiXCIpXG4gICAgICBjb25zdCBpbnB1dDogU0VDUFRyYW5zZmVySW5wdXQgPSBuZXcgU0VDUFRyYW5zZmVySW5wdXQoT05FQVhDKVxuICAgICAgY29uc3QgeGZlcmluOiBUcmFuc2ZlcmFibGVJbnB1dCA9IG5ldyBUcmFuc2ZlcmFibGVJbnB1dChcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZSh0eElEKSxcbiAgICAgICAgb3V0cHV0aWR4LFxuICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKGF4Y0Fzc2V0SUQpLFxuICAgICAgICBpbnB1dFxuICAgICAgKVxuICAgICAgaW1wb3J0ZWRJbnMucHVzaCh4ZmVyaW4pXG4gICAgICBjb25zdCBldm1PdXRwdXQ6IEVWTU91dHB1dCA9IG5ldyBFVk1PdXRwdXQoXG4gICAgICAgIGNIZXhBZGRyZXNzMSxcbiAgICAgICAgT05FQVhDLnN1YihNSUxMSUFYQyksXG4gICAgICAgIGF4Y0Fzc2V0SURcbiAgICAgIClcbiAgICAgIGV2bU91dHB1dHMucHVzaChldm1PdXRwdXQpXG4gICAgICBjb25zdCBpbXBvcnRUeDogSW1wb3J0VHggPSBuZXcgSW1wb3J0VHgoXG4gICAgICAgIG5ldHdvcmtJRCxcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShibG9ja2NoYWluSUQpLFxuICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKHNvdXJjZWNoYWluSUQpLFxuICAgICAgICBpbXBvcnRlZElucyxcbiAgICAgICAgZXZtT3V0cHV0c1xuICAgICAgKVxuICAgICAgZXhwZWN0KGltcG9ydFR4KS50b0JlSW5zdGFuY2VPZihJbXBvcnRUeClcbiAgICB9KVxuICB9KVxuICBkZXNjcmliZShcIkV4cG9ydFR4XCIsICgpID0+IHtcbiAgICB0ZXN0KFwiZ2V0RGVzdGluYXRpb25DaGFpblwiLCAoKTogdm9pZCA9PiB7XG4gICAgICBjb25zdCBleHBvcnRUeDogRXhwb3J0VHggPSBuZXcgRXhwb3J0VHgoXG4gICAgICAgIG5ldHdvcmtJRCxcbiAgICAgICAgYmludG9vbHMuY2I1OERlY29kZShibG9ja2NoYWluSUQpLFxuICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKFBsYXRmb3JtQ2hhaW5JRClcbiAgICAgIClcbiAgICAgIGV4cGVjdChleHBvcnRUeCkudG9CZUluc3RhbmNlT2YoRXhwb3J0VHgpXG4gICAgICBleHBlY3QoZXhwb3J0VHguZ2V0RGVzdGluYXRpb25DaGFpbigpLnRvU3RyaW5nKFwiaGV4XCIpKS50b0JlKFxuICAgICAgICBiaW50b29scy5jYjU4RGVjb2RlKFBsYXRmb3JtQ2hhaW5JRCkudG9TdHJpbmcoXCJoZXhcIilcbiAgICAgIClcbiAgICB9KVxuICB9KVxufSlcbiJdfQ==