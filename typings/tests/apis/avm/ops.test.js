"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const utxos_1 = require("../../../src/apis/avm/utxos");
const create_hash_1 = __importDefault(require("create-hash"));
const bintools_1 = __importDefault(require("../../../src/utils/bintools"));
const bn_js_1 = __importDefault(require("bn.js"));
const buffer_1 = require("buffer/");
const outputs_1 = require("../../../src/apis/avm/outputs");
const constants_1 = require("../../../src/apis/avm/constants");
const ops_1 = require("../../../src/apis/avm/ops");
const output_1 = require("../../../src/common/output");
const ops_2 = require("../../../src/apis/avm/ops");
/**
 * @ignore
 */
const bintools = bintools_1.default.getInstance();
describe("Operations", () => {
    const codecID_zero = 0;
    const codecID_one = 1;
    const assetID = "8a5d2d32e68bc50036e4d086044617fe4a0a0296b274999ba568ea92da46d533";
    const assetIDBuff = buffer_1.Buffer.from(assetID, "hex");
    const addrs = [
        bintools.cb58Decode("B6D4v1VtPYLbiUvYXtW4Px8oE9imC2vGW"),
        bintools.cb58Decode("P5wdRuZeaDt28eHMP5S3w9ZdoBfo7wuzF"),
        bintools.cb58Decode("6Y3kysjF9jnHnYkdS9yGAuoHyae2eNmeV")
    ].sort();
    const locktime = new bn_js_1.default(54321);
    const payload = buffer_1.Buffer.alloc(1024);
    payload.write("All you Trekkies and TV addicts, Don't mean to diss don't mean to bring static.", 0, 1024, "utf8");
    describe("NFTMintOperation", () => {
        test("SelectOperationClass", () => {
            const goodop = new ops_1.NFTMintOperation(0, buffer_1.Buffer.from(""), []);
            const operation = (0, ops_1.SelectOperationClass)(goodop.getOperationID());
            expect(operation).toBeInstanceOf(ops_1.NFTMintOperation);
            expect(() => {
                (0, ops_1.SelectOperationClass)(99);
            }).toThrow("Error - SelectOperationClass: unknown opid");
        });
        test("comparator", () => {
            const outputOwners = [];
            outputOwners.push(new output_1.OutputOwners(addrs, locktime, 1));
            const op1 = new ops_1.NFTMintOperation(1, payload, outputOwners);
            const op2 = new ops_1.NFTMintOperation(2, payload, outputOwners);
            const op3 = new ops_1.NFTMintOperation(0, payload, outputOwners);
            const cmp = ops_1.NFTMintOperation.comparator();
            expect(cmp(op1, op1)).toBe(0);
            expect(cmp(op2, op2)).toBe(0);
            expect(cmp(op3, op3)).toBe(0);
            expect(cmp(op1, op2)).toBe(-1);
            expect(cmp(op1, op3)).toBe(1);
        });
        test("Functionality", () => {
            const outputOwners = [];
            outputOwners.push(new output_1.OutputOwners(addrs, locktime, 1));
            const op = new ops_1.NFTMintOperation(0, payload, outputOwners);
            expect(op.getOperationID()).toBe(constants_1.AVMConstants.NFTMINTOPID);
            expect(op.getOutputOwners().toString()).toBe(outputOwners.toString());
            const opcopy = new ops_1.NFTMintOperation();
            const opb = op.toBuffer();
            opcopy.fromBuffer(opb);
            expect(opcopy.toString()).toBe(op.toString());
        });
        test("NFTMintOperation codecIDs", () => {
            const outputOwners = [];
            outputOwners.push(new output_1.OutputOwners(addrs, locktime, 1));
            const nftMintOperation = new ops_1.NFTMintOperation(0, payload, outputOwners);
            expect(nftMintOperation.getCodecID()).toBe(codecID_zero);
            expect(nftMintOperation.getOperationID()).toBe(constants_1.AVMConstants.NFTMINTOPID);
            nftMintOperation.setCodecID(codecID_one);
            expect(nftMintOperation.getCodecID()).toBe(codecID_one);
            expect(nftMintOperation.getOperationID()).toBe(constants_1.AVMConstants.NFTMINTOPID_CODECONE);
            nftMintOperation.setCodecID(codecID_zero);
            expect(nftMintOperation.getCodecID()).toBe(codecID_zero);
            expect(nftMintOperation.getOperationID()).toBe(constants_1.AVMConstants.NFTMINTOPID);
        });
        test("Invalid NFTMintOperation codecID", () => {
            const outputOwners = [];
            outputOwners.push(new output_1.OutputOwners(addrs, locktime, 1));
            const nftMintOperation = new ops_1.NFTMintOperation(0, payload, outputOwners);
            expect(() => {
                nftMintOperation.setCodecID(2);
            }).toThrow("Error - NFTMintOperation.setCodecID: invalid codecID. Valid codecIDs are 0 and 1.");
        });
    });
    describe("NFTTransferOperation", () => {
        test("SelectOperationClass", () => {
            const nout = new outputs_1.NFTTransferOutput(1000, payload, addrs, locktime, 1);
            const goodop = new ops_1.NFTTransferOperation(nout);
            const operation = (0, ops_1.SelectOperationClass)(goodop.getOperationID());
            expect(operation).toBeInstanceOf(ops_1.NFTTransferOperation);
            expect(() => {
                (0, ops_1.SelectOperationClass)(99);
            }).toThrow("Error - SelectOperationClass: unknown opid");
        });
        test("comparator", () => {
            const op1 = new ops_1.NFTTransferOperation(new outputs_1.NFTTransferOutput(1000, payload, addrs, locktime, 1));
            const op2 = new ops_1.NFTTransferOperation(new outputs_1.NFTTransferOutput(1001, payload, addrs, locktime, 1));
            const op3 = new ops_1.NFTTransferOperation(new outputs_1.NFTTransferOutput(999, payload, addrs, locktime, 1));
            const cmp = ops_1.NFTTransferOperation.comparator();
            expect(cmp(op1, op1)).toBe(0);
            expect(cmp(op2, op2)).toBe(0);
            expect(cmp(op3, op3)).toBe(0);
            expect(cmp(op1, op2)).toBe(-1);
            expect(cmp(op1, op3)).toBe(1);
        });
        test("Functionality", () => {
            const nout = new outputs_1.NFTTransferOutput(1000, payload, addrs, locktime, 1);
            const op = new ops_1.NFTTransferOperation(nout);
            expect(op.getOperationID()).toBe(constants_1.AVMConstants.NFTXFEROPID);
            expect(op.getOutput().toString()).toBe(nout.toString());
            const opcopy = new ops_1.NFTTransferOperation();
            opcopy.fromBuffer(op.toBuffer());
            expect(opcopy.toString()).toBe(op.toString());
            op.addSignatureIdx(0, addrs[0]);
            const sigidx = op.getSigIdxs();
            expect(sigidx[0].getSource().toString("hex")).toBe(addrs[0].toString("hex"));
            opcopy.fromBuffer(op.toBuffer());
            expect(opcopy.toString()).toBe(op.toString());
        });
        test("NFTTransferOperation codecIDs", () => {
            const nftTransferOperation = new ops_1.NFTTransferOperation(new outputs_1.NFTTransferOutput(1000, payload, addrs, locktime, 1));
            expect(nftTransferOperation.getCodecID()).toBe(codecID_zero);
            expect(nftTransferOperation.getOperationID()).toBe(constants_1.AVMConstants.NFTXFEROPID);
            nftTransferOperation.setCodecID(codecID_one);
            expect(nftTransferOperation.getCodecID()).toBe(codecID_one);
            expect(nftTransferOperation.getOperationID()).toBe(constants_1.AVMConstants.NFTXFEROPID_CODECONE);
            nftTransferOperation.setCodecID(codecID_zero);
            expect(nftTransferOperation.getCodecID()).toBe(codecID_zero);
            expect(nftTransferOperation.getOperationID()).toBe(constants_1.AVMConstants.NFTXFEROPID);
        });
        test("Invalid NFTTransferOperation codecID", () => {
            const nftTransferOperation = new ops_1.NFTTransferOperation(new outputs_1.NFTTransferOutput(1000, payload, addrs, locktime, 1));
            expect(() => {
                nftTransferOperation.setCodecID(2);
            }).toThrow("Error - NFTTransferOperation.setCodecID: invalid codecID. Valid codecIDs are 0 and 1.");
        });
    });
    test("TransferableOperation", () => {
        const nout = new outputs_1.NFTTransferOutput(1000, payload, addrs, locktime, 1);
        const op = new ops_1.NFTTransferOperation(nout);
        const nfttxid = buffer_1.Buffer.from((0, create_hash_1.default)("sha256")
            .update(bintools.fromBNToBuffer(new bn_js_1.default(1000), 32))
            .digest());
        const nftoutputidx = buffer_1.Buffer.from(bintools.fromBNToBuffer(new bn_js_1.default(1000), 4));
        const nftutxo = new utxos_1.UTXO(constants_1.AVMConstants.LATESTCODEC, nfttxid, nftoutputidx, assetIDBuff, nout);
        const xferop = new ops_1.TransferableOperation(assetIDBuff, [nftutxo.getUTXOID()], op);
        const xferop2 = new ops_1.TransferableOperation(assetIDBuff, [buffer_1.Buffer.concat([nfttxid, nftoutputidx])], op);
        const uid = new ops_2.UTXOID();
        uid.fromString(nftutxo.getUTXOID());
        const xferop3 = new ops_1.TransferableOperation(assetIDBuff, [uid], op);
        expect(xferop.getAssetID().toString("hex")).toBe(assetID);
        const utxoiddeserialized = bintools.cb58Decode(xferop.getUTXOIDs()[0].toString());
        expect(bintools.bufferToB58(utxoiddeserialized)).toBe(nftutxo.getUTXOID());
        expect(xferop.getOperation().toString()).toBe(op.toString());
        const opcopy = new ops_1.TransferableOperation();
        opcopy.fromBuffer(xferop.toBuffer());
        expect(opcopy.toString()).toBe(xferop.toString());
        expect(xferop2.toBuffer().toString("hex")).toBe(xferop.toBuffer().toString("hex"));
        expect(xferop3.toBuffer().toString("hex")).toBe(xferop.toBuffer().toString("hex"));
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3BzLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi90ZXN0cy9hcGlzL2F2bS9vcHMudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLHVEQUFrRDtBQUNsRCw4REFBb0M7QUFDcEMsMkVBQWtEO0FBQ2xELGtEQUFzQjtBQUN0QixvQ0FBZ0M7QUFDaEMsMkRBQWlFO0FBQ2pFLCtEQUE4RDtBQUM5RCxtREFNa0M7QUFDbEMsdURBQXlEO0FBRXpELG1EQUFrRDtBQUVsRDs7R0FFRztBQUNILE1BQU0sUUFBUSxHQUFhLGtCQUFRLENBQUMsV0FBVyxFQUFFLENBQUE7QUFFakQsUUFBUSxDQUFDLFlBQVksRUFBRSxHQUFTLEVBQUU7SUFDaEMsTUFBTSxZQUFZLEdBQVcsQ0FBQyxDQUFBO0lBQzlCLE1BQU0sV0FBVyxHQUFXLENBQUMsQ0FBQTtJQUM3QixNQUFNLE9BQU8sR0FDWCxrRUFBa0UsQ0FBQTtJQUNwRSxNQUFNLFdBQVcsR0FBVyxlQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQTtJQUN2RCxNQUFNLEtBQUssR0FBYTtRQUN0QixRQUFRLENBQUMsVUFBVSxDQUFDLG1DQUFtQyxDQUFDO1FBQ3hELFFBQVEsQ0FBQyxVQUFVLENBQUMsbUNBQW1DLENBQUM7UUFDeEQsUUFBUSxDQUFDLFVBQVUsQ0FBQyxtQ0FBbUMsQ0FBQztLQUN6RCxDQUFDLElBQUksRUFBRSxDQUFBO0lBRVIsTUFBTSxRQUFRLEdBQU8sSUFBSSxlQUFFLENBQUMsS0FBSyxDQUFDLENBQUE7SUFFbEMsTUFBTSxPQUFPLEdBQVcsZUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQTtJQUMxQyxPQUFPLENBQUMsS0FBSyxDQUNYLGlGQUFpRixFQUNqRixDQUFDLEVBQ0QsSUFBSSxFQUNKLE1BQU0sQ0FDUCxDQUFBO0lBRUQsUUFBUSxDQUFDLGtCQUFrQixFQUFFLEdBQVMsRUFBRTtRQUN0QyxJ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QUksQ0FDN0MsTUFBTSxDQUFDLFFBQVEsRUFBRSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FDbEMsQ0FBQTtRQUNELE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUM3QyxNQUFNLENBQUMsUUFBUSxFQUFFLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUNsQyxDQUFBO0lBQ0gsQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFVUWE8gfSBmcm9tIFwiLi4vLi4vLi4vc3JjL2FwaXMvYXZtL3V0eG9zXCJcclxuaW1wb3J0IGNyZWF0ZUhhc2ggZnJvbSBcImNyZWF0ZS1oYXNoXCJcclxuaW1wb3J0IEJpblRvb2xzIGZyb20gXCIuLi8uLi8uLi9zcmMvdXRpbHMvYmludG9vbHNcIlxyXG5pbXBvcnQgQk4gZnJvbSBcImJuLmpzXCJcclxuaW1wb3J0IHsgQnVmZmVyIH0gZnJvbSBcImJ1ZmZlci9cIlxyXG5pbXBvcnQgeyBORlRUcmFuc2Zlck91dHB1dCB9IGZyb20gXCIuLi8uLi8uLi9zcmMvYXBpcy9hdm0vb3V0cHV0c1wiXHJcbmltcG9ydCB7IEFWTUNvbnN0YW50cyB9IGZyb20gXCIuLi8uLi8uLi9zcmMvYXBpcy9hdm0vY29uc3RhbnRzXCJcclxuaW1wb3J0IHtcclxuICBTZWxlY3RPcGVyYXRpb25DbGFzcyxcclxuICBPcGVyYXRpb24sXHJcbiAgVHJhbnNmZXJhYmxlT3BlcmF0aW9uLFxyXG4gIE5GVFRyYW5zZmVyT3BlcmF0aW9uLFxyXG4gIE5GVE1pbnRPcGVyYXRpb25cclxufSBmcm9tIFwiLi4vLi4vLi4vc3JjL2FwaXMvYXZtL29wc1wiXHJcbmltcG9ydCB7IE91dHB1dE93bmVycyB9IGZyb20gXCIuLi8uLi8uLi9zcmMvY29tbW9uL291dHB1dFwiXHJcbmltcG9ydCB7IFNpZ0lkeCB9IGZyb20gXCIuLi8uLi8uLi9zcmMvY29tbW9uL2NyZWRlbnRpYWxzXCJcclxuaW1wb3J0IHsgVVRYT0lEIH0gZnJvbSBcIi4uLy4uLy4uL3NyYy9hcGlzL2F2bS9vcHNcIlxyXG5cclxuLyoqXHJcbiAqIEBpZ25vcmVcclxuICovXHJcbmNvbnN0IGJpbnRvb2xzOiBCaW5Ub29scyA9IEJpblRvb2xzLmdldEluc3RhbmNlKClcclxuXHJcbmRlc2NyaWJlKFwiT3BlcmF0aW9uc1wiLCAoKTogdm9pZCA9PiB7XHJcbiAgY29uc3QgY29kZWNJRF96ZXJvOiBudW1iZXIgPSAwXHJcbiAgY29uc3QgY29kZWNJRF9vbmU6IG51bWJlciA9IDFcclxuICBjb25zdCBhc3NldElEOiBzdHJpbmcgPVxyXG4gICAgXCI4YTVkMmQzMmU2OGJjNTAwMzZlNGQwODYwNDQ2MTdmZTRhMGEwMjk2YjI3NDk5OWJhNTY4ZWE5MmRhNDZkNTMzXCJcclxuICBjb25zdCBhc3NldElEQnVmZjogQnVmZmVyID0gQnVmZmVyLmZyb20oYXNzZXRJRCwgXCJoZXhcIilcclxuICBjb25zdCBhZGRyczogQnVmZmVyW10gPSBbXHJcbiAgICBiaW50b29scy5jYjU4RGVjb2RlKFwiQjZENHYxVnRQWUxiaVV2WVh0VzRQeDhvRTlpbUMydkdXXCIpLFxyXG4gICAgYmludG9vbHMuY2I1OERlY29kZShcIlA1d2RSdVplYUR0MjhlSE1QNVMzdzlaZG9CZm83d3V6RlwiKSxcclxuICAgIGJpbnRvb2xzLmNiNThEZWNvZGUoXCI2WTNreXNqRjlqbkhuWWtkUzl5R0F1b0h5YWUyZU5tZVZcIilcclxuICBdLnNvcnQoKVxyXG5cclxuICBjb25zdCBsb2NrdGltZTogQk4gPSBuZXcgQk4oNTQzMjEpXHJcblxyXG4gIGNvbnN0IHBheWxvYWQ6IEJ1ZmZlciA9IEJ1ZmZlci5hbGxvYygxMDI0KVxyXG4gIHBheWxvYWQud3JpdGUoXHJcbiAgICBcIkFsbCB5b3UgVHJla2tpZXMgYW5kIFRWIGFkZGljdHMsIERvbid0IG1lYW4gdG8gZGlzcyBkb24ndCBtZWFuIHRvIGJyaW5nIHN0YXRpYy5cIixcclxuICAgIDAsXHJcbiAgICAxMDI0LFxyXG4gICAgXCJ1dGY4XCJcclxuICApXHJcblxyXG4gIGRlc2NyaWJlKFwiTkZUTWludE9wZXJhdGlvblwiLCAoKTogdm9pZCA9PiB7XHJcbiAgICB0ZXN0KFwiU2VsZWN0T3BlcmF0aW9uQ2xhc3NcIiwgKCk6IHZvaWQgPT4ge1xyXG4gICAgICBjb25zdCBnb29kb3A6IE5GVE1pbnRPcGVyYXRpb24gPSBuZXcgTkZUTWludE9wZXJhdGlvbihcclxuICAgICAgICAwLFxyXG4gICAgICAgIEJ1ZmZlci5mcm9tKFwiXCIpLFxyXG4gICAgICAgIFtdXHJcbiAgICAgIClcclxuICAgICAgY29uc3Qgb3BlcmF0aW9uOiBPcGVyYXRpb24gPSBTZWxlY3RPcGVyYXRpb25DbGFzcyhnb29kb3AuZ2V0T3BlcmF0aW9uSUQoKSlcclxuICAgICAgZXhwZWN0KG9wZXJhdGlvbikudG9CZUluc3RhbmNlT2YoTkZUTWludE9wZXJhdGlvbilcclxuICAgICAgZXhwZWN0KCgpID0+IHtcclxuICAgICAgICBTZWxlY3RPcGVyYXRpb25DbGFzcyg5OSlcclxuICAgICAgfSkudG9UaHJvdyhcIkVycm9yIC0gU2VsZWN0T3BlcmF0aW9uQ2xhc3M6IHVua25vd24gb3BpZFwiKVxyXG4gICAgfSlcclxuXHJcbiAgICB0ZXN0KFwiY29tcGFyYXRvclwiLCAoKTogdm9pZCA9PiB7XHJcbiAgICAgIGNvbnN0IG91dHB1dE93bmVyczogT3V0cHV0T3duZXJzW10gPSBbXVxyXG4gICAgICBvdXRwdXRPd25lcnMucHVzaChuZXcgT3V0cHV0T3duZXJzKGFkZHJzLCBsb2NrdGltZSwgMSkpXHJcbiAgICAgIGNvbnN0IG9wMTogTkZUTWludE9wZXJhdGlvbiA9IG5ldyBORlRNaW50T3BlcmF0aW9uKFxyXG4gICAgICAgIDEsXHJcbiAgICAgICAgcGF5bG9hZCxcclxuICAgICAgICBvdXRwdXRPd25lcnNcclxuICAgICAgKVxyXG4gICAgICBjb25zdCBvcDI6IE5GVE1pbnRPcGVyYXRpb24gPSBuZXcgTkZUTWludE9wZXJhdGlvbihcclxuICAgICAgICAyLFxyXG4gICAgICAgIHBheWxvYWQsXHJcbiAgICAgICAgb3V0cHV0T3duZXJzXHJcbiAgICAgIClcclxuICAgICAgY29uc3Qgb3AzOiBORlRNaW50T3BlcmF0aW9uID0gbmV3IE5GVE1pbnRPcGVyYXRpb24oXHJcbiAgICAgICAgMCxcclxuICAgICAgICBwYXlsb2FkLFxyXG4gICAgICAgIG91dHB1dE93bmVyc1xyXG4gICAgICApXHJcbiAgICAgIGNvbnN0IGNtcCA9IE5GVE1pbnRPcGVyYXRpb24uY29tcGFyYXRvcigpXHJcbiAgICAgIGV4cGVjdChjbXAob3AxLCBvcDEpKS50b0JlKDApXHJcbiAgICAgIGV4cGVjdChjbXAob3AyLCBvcDIpKS50b0JlKDApXHJcbiAgICAgIGV4cGVjdChjbXAob3AzLCBvcDMpKS50b0JlKDApXHJcbiAgICAgIGV4cGVjdChjbXAob3AxLCBvcDIpKS50b0JlKC0xKVxyXG4gICAgICBleHBlY3QoY21wKG9wMSwgb3AzKSkudG9CZSgxKVxyXG4gICAgfSlcclxuXHJcbiAgICB0ZXN0KFwiRnVuY3Rpb25hbGl0eVwiLCAoKTogdm9pZCA9PiB7XHJcbiAgICAgIGNvbnN0IG91dHB1dE93bmVyczogT3V0cHV0T3duZXJzW10gPSBbXVxyXG4gICAgICBvdXRwdXRPd25lcnMucHVzaChuZXcgT3V0cHV0T3duZXJzKGFkZHJzLCBsb2NrdGltZSwgMSkpXHJcbiAgICAgIGNvbnN0IG9wOiBORlRNaW50T3BlcmF0aW9uID0gbmV3IE5GVE1pbnRPcGVyYXRpb24oXHJcbiAgICAgICAgMCxcclxuICAgICAgICBwYXlsb2FkLFxyXG4gICAgICAgIG91dHB1dE93bmVyc1xyXG4gICAgICApXHJcblxyXG4gICAgICBleHBlY3Qob3AuZ2V0T3BlcmF0aW9uSUQoKSkudG9CZShBVk1Db25zdGFudHMuTkZUTUlOVE9QSUQpXHJcbiAgICAgIGV4cGVjdChvcC5nZXRPdXRwdXRPd25lcnMoKS50b1N0cmluZygpKS50b0JlKG91dHB1dE93bmVycy50b1N0cmluZygpKVxyXG5cclxuICAgICAgY29uc3Qgb3Bjb3B5OiBORlRNaW50T3BlcmF0aW9uID0gbmV3IE5GVE1pbnRPcGVyYXRpb24oKVxyXG4gICAgICBjb25zdCBvcGI6IEJ1ZmZlciA9IG9wLnRvQnVmZmVyKClcclxuICAgICAgb3Bjb3B5LmZyb21CdWZmZXIob3BiKVxyXG4gICAgICBleHBlY3Qob3Bjb3B5LnRvU3RyaW5nKCkpLnRvQmUob3AudG9TdHJpbmcoKSlcclxuICAgIH0pXHJcblxyXG4gICAgdGVzdChcIk5GVE1pbnRPcGVyYXRpb24gY29kZWNJRHNcIiwgKCk6IHZvaWQgPT4ge1xyXG4gICAgICBjb25zdCBvdXRwdXRPd25lcnM6IE91dHB1dE93bmVyc1tdID0gW11cclxuICAgICAgb3V0cHV0T3duZXJzLnB1c2gobmV3IE91dHB1dE93bmVycyhhZGRycywgbG9ja3RpbWUsIDEpKVxyXG4gICAgICBjb25zdCBuZnRNaW50T3BlcmF0aW9uOiBORlRNaW50T3BlcmF0aW9uID0gbmV3IE5GVE1pbnRPcGVyYXRpb24oXHJcbiAgICAgICAgMCxcclxuICAgICAgICBwYXlsb2FkLFxyXG4gICAgICAgIG91dHB1dE93bmVyc1xyXG4gICAgICApXHJcbiAgICAgIGV4cGVjdChuZnRNaW50T3BlcmF0aW9uLmdldENvZGVjSUQoKSkudG9CZShjb2RlY0lEX3plcm8pXHJcbiAgICAgIGV4cGVjdChuZnRNaW50T3BlcmF0aW9uLmdldE9wZXJhdGlvbklEKCkpLnRvQmUoQVZNQ29uc3RhbnRzLk5GVE1JTlRPUElEKVxyXG4gICAgICBuZnRNaW50T3BlcmF0aW9uLnNldENvZGVjSUQoY29kZWNJRF9vbmUpXHJcbiAgICAgIGV4cGVjdChuZnRNaW50T3BlcmF0aW9uLmdldENvZGVjSUQoKSkudG9CZShjb2RlY0lEX29uZSlcclxuICAgICAgZXhwZWN0KG5mdE1pbnRPcGVyYXRpb24uZ2V0T3BlcmF0aW9uSUQoKSkudG9CZShcclxuICAgICAgICBBVk1Db25zdGFudHMuTkZUTUlOVE9QSURfQ09ERUNPTkVcclxuICAgICAgKVxyXG4gICAgICBuZnRNaW50T3BlcmF0aW9uLnNldENvZGVjSUQoY29kZWNJRF96ZXJvKVxyXG4gICAgICBleHBlY3QobmZ0TWludE9wZXJhdGlvbi5nZXRDb2RlY0lEKCkpLnRvQmUoY29kZWNJRF96ZXJvKVxyXG4gICAgICBleHBlY3QobmZ0TWludE9wZXJhdGlvbi5nZXRPcGVyYXRpb25JRCgpKS50b0JlKEFWTUNvbnN0YW50cy5ORlRNSU5UT1BJRClcclxuICAgIH0pXHJcblxyXG4gICAgdGVzdChcIkludmFsaWQgTkZUTWludE9wZXJhdGlvbiBjb2RlY0lEXCIsICgpOiB2b2lkID0+IHtcclxuICAgICAgY29uc3Qgb3V0cHV0T3duZXJzOiBPdXRwdXRPd25lcnNbXSA9IFtdXHJcbiAgICAgIG91dHB1dE93bmVycy5wdXNoKG5ldyBPdXRwdXRPd25lcnMoYWRkcnMsIGxvY2t0aW1lLCAxKSlcclxuICAgICAgY29uc3QgbmZ0TWludE9wZXJhdGlvbjogTkZUTWludE9wZXJhdGlvbiA9IG5ldyBORlRNaW50T3BlcmF0aW9uKFxyXG4gICAgICAgIDAsXHJcbiAgICAgICAgcGF5bG9hZCxcclxuICAgICAgICBvdXRwdXRPd25lcnNcclxuICAgICAgKVxyXG4gICAgICBleHBlY3QoKCkgPT4ge1xyXG4gICAgICAgIG5mdE1pbnRPcGVyYXRpb24uc2V0Q29kZWNJRCgyKVxyXG4gICAgICB9KS50b1Rocm93KFxyXG4gICAgICAgIFwiRXJyb3IgLSBORlRNaW50T3BlcmF0aW9uLnNldENvZGVjSUQ6IGludmFsaWQgY29kZWNJRC4gVmFsaWQgY29kZWNJRHMgYXJlIDAgYW5kIDEuXCJcclxuICAgICAgKVxyXG4gICAgfSlcclxuICB9KVxyXG5cclxuICBkZXNjcmliZShcIk5GVFRyYW5zZmVyT3BlcmF0aW9uXCIsICgpOiB2b2lkID0+IHtcclxuICAgIHRlc3QoXCJTZWxlY3RPcGVyYXRpb25DbGFzc1wiLCAoKTogdm9pZCA9PiB7XHJcbiAgICAgIGNvbnN0IG5vdXQ6IE5GVFRyYW5zZmVyT3V0cHV0ID0gbmV3IE5GVFRyYW5zZmVyT3V0cHV0KFxyXG4gICAgICAgIDEwMDAsXHJcbiAgICAgICAgcGF5bG9hZCxcclxuICAgICAgICBhZGRycyxcclxuICAgICAgICBsb2NrdGltZSxcclxuICAgICAgICAxXHJcbiAgICAgIClcclxuICAgICAgY29uc3QgZ29vZG9wOiBORlRUcmFuc2Zlck9wZXJhdGlvbiA9IG5ldyBORlRUcmFuc2Zlck9wZXJhdGlvbihub3V0KVxyXG4gICAgICBjb25zdCBvcGVyYXRpb246IE9wZXJhdGlvbiA9IFNlbGVjdE9wZXJhdGlvbkNsYXNzKGdvb2RvcC5nZXRPcGVyYXRpb25JRCgpKVxyXG4gICAgICBleHBlY3Qob3BlcmF0aW9uKS50b0JlSW5zdGFuY2VPZihORlRUcmFuc2Zlck9wZXJhdGlvbilcclxuICAgICAgZXhwZWN0KCgpOiB2b2lkID0+IHtcclxuICAgICAgICBTZWxlY3RPcGVyYXRpb25DbGFzcyg5OSlcclxuICAgICAgfSkudG9UaHJvdyhcIkVycm9yIC0gU2VsZWN0T3BlcmF0aW9uQ2xhc3M6IHVua25vd24gb3BpZFwiKVxyXG4gICAgfSlcclxuXHJcbiAgICB0ZXN0KFwiY29tcGFyYXRvclwiLCAoKTogdm9pZCA9PiB7XHJcbiAgICAgIGNvbnN0IG9wMTogTkZUVHJhbnNmZXJPcGVyYXRpb24gPSBuZXcgTkZUVHJhbnNmZXJPcGVyYXRpb24oXHJcbiAgICAgICAgbmV3IE5GVFRyYW5zZmVyT3V0cHV0KDEwMDAsIHBheWxvYWQsIGFkZHJzLCBsb2NrdGltZSwgMSlcclxuICAgICAgKVxyXG4gICAgICBjb25zdCBvcDI6IE5GVFRyYW5zZmVyT3BlcmF0aW9uID0gbmV3IE5GVFRyYW5zZmVyT3BlcmF0aW9uKFxyXG4gICAgICAgIG5ldyBORlRUcmFuc2Zlck91dHB1dCgxMDAxLCBwYXlsb2FkLCBhZGRycywgbG9ja3RpbWUsIDEpXHJcbiAgICAgIClcclxuICAgICAgY29uc3Qgb3AzOiBORlRUcmFuc2Zlck9wZXJhdGlvbiA9IG5ldyBORlRUcmFuc2Zlck9wZXJhdGlvbihcclxuICAgICAgICBuZXcgTkZUVHJhbnNmZXJPdXRwdXQoOTk5LCBwYXlsb2FkLCBhZGRycywgbG9ja3RpbWUsIDEpXHJcbiAgICAgIClcclxuICAgICAgY29uc3QgY21wID0gTkZUVHJhbnNmZXJPcGVyYXRpb24uY29tcGFyYXRvcigpXHJcbiAgICAgIGV4cGVjdChjbXAob3AxLCBvcDEpKS50b0JlKDApXHJcbiAgICAgIGV4cGVjdChjbXAob3AyLCBvcDIpKS50b0JlKDApXHJcbiAgICAgIGV4cGVjdChjbXAob3AzLCBvcDMpKS50b0JlKDApXHJcbiAgICAgIGV4cGVjdChjbXAob3AxLCBvcDIpKS50b0JlKC0xKVxyXG4gICAgICBleHBlY3QoY21wKG9wMSwgb3AzKSkudG9CZSgxKVxyXG4gICAgfSlcclxuXHJcbiAgICB0ZXN0KFwiRnVuY3Rpb25hbGl0eVwiLCAoKTogdm9pZCA9PiB7XHJcbiAgICAgIGNvbnN0IG5vdXQ6IE5GVFRyYW5zZmVyT3V0cHV0ID0gbmV3IE5GVFRyYW5zZmVyT3V0cHV0KFxyXG4gICAgICAgIDEwMDAsXHJcbiAgICAgICAgcGF5bG9hZCxcclxuICAgICAgICBhZGRycyxcclxuICAgICAgICBsb2NrdGltZSxcclxuICAgICAgICAxXHJcbiAgICAgIClcclxuICAgICAgY29uc3Qgb3A6IE5GVFRyYW5zZmVyT3BlcmF0aW9uID0gbmV3IE5GVFRyYW5zZmVyT3BlcmF0aW9uKG5vdXQpXHJcblxyXG4gICAgICBleHBlY3Qob3AuZ2V0T3BlcmF0aW9uSUQoKSkudG9CZShBVk1Db25zdGFudHMuTkZUWEZFUk9QSUQpXHJcbiAgICAgIGV4cGVjdChvcC5nZXRPdXRwdXQoKS50b1N0cmluZygpKS50b0JlKG5vdXQudG9TdHJpbmcoKSlcclxuXHJcbiAgICAgIGNvbnN0IG9wY29weTogTkZUVHJhbnNmZXJPcGVyYXRpb24gPSBuZXcgTkZUVHJhbnNmZXJPcGVyYXRpb24oKVxyXG4gICAgICBvcGNvcHkuZnJvbUJ1ZmZlcihvcC50b0J1ZmZlcigpKVxyXG4gICAgICBleHBlY3Qob3Bjb3B5LnRvU3RyaW5nKCkpLnRvQmUob3AudG9TdHJpbmcoKSlcclxuXHJcbiAgICAgIG9wLmFkZFNpZ25hdHVyZUlkeCgwLCBhZGRyc1swXSlcclxuICAgICAgY29uc3Qgc2lnaWR4OiBTaWdJZHhbXSA9IG9wLmdldFNpZ0lkeHMoKVxyXG4gICAgICBleHBlY3Qoc2lnaWR4WzBdLmdldFNvdXJjZSgpLnRvU3RyaW5nKFwiaGV4XCIpKS50b0JlKFxyXG4gICAgICAgIGFkZHJzWzBdLnRvU3RyaW5nKFwiaGV4XCIpXHJcbiAgICAgIClcclxuICAgICAgb3Bjb3B5LmZyb21CdWZmZXIob3AudG9CdWZmZXIoKSlcclxuICAgICAgZXhwZWN0KG9wY29weS50b1N0cmluZygpKS50b0JlKG9wLnRvU3RyaW5nKCkpXHJcbiAgICB9KVxyXG5cclxuICAgIHRlc3QoXCJORlRUcmFuc2Zlck9wZXJhdGlvbiBjb2RlY0lEc1wiLCAoKTogdm9pZCA9PiB7XHJcbiAgICAgIGNvbnN0IG5mdFRyYW5zZmVyT3BlcmF0aW9uOiBORlRUcmFuc2Zlck9wZXJhdGlvbiA9XHJcbiAgICAgICAgbmV3IE5GVFRyYW5zZmVyT3BlcmF0aW9uKFxyXG4gICAgICAgICAgbmV3IE5GVFRyYW5zZmVyT3V0cHV0KDEwMDAsIHBheWxvYWQsIGFkZHJzLCBsb2NrdGltZSwgMSlcclxuICAgICAgICApXHJcbiAgICAgIGV4cGVjdChuZnRUcmFuc2Zlck9wZXJhdGlvbi5nZXRDb2RlY0lEKCkpLnRvQmUoY29kZWNJRF96ZXJvKVxyXG4gICAgICBleHBlY3QobmZ0VHJhbnNmZXJPcGVyYXRpb24uZ2V0T3BlcmF0aW9uSUQoKSkudG9CZShcclxuICAgICAgICBBVk1Db25zdGFudHMuTkZUWEZFUk9QSURcclxuICAgICAgKVxyXG4gICAgICBuZnRUcmFuc2Zlck9wZXJhdGlvbi5zZXRDb2RlY0lEKGNvZGVjSURfb25lKVxyXG4gICAgICBleHBlY3QobmZ0VHJhbnNmZXJPcGVyYXRpb24uZ2V0Q29kZWNJRCgpKS50b0JlKGNvZGVjSURfb25lKVxyXG4gICAgICBleHBlY3QobmZ0VHJhbnNmZXJPcGVyYXRpb24uZ2V0T3BlcmF0aW9uSUQoKSkudG9CZShcclxuICAgICAgICBBVk1Db25zdGFudHMuTkZUWEZFUk9QSURfQ09ERUNPTkVcclxuICAgICAgKVxyXG4gICAgICBuZnRUcmFuc2Zlck9wZXJhdGlvbi5zZXRDb2RlY0lEKGNvZGVjSURfemVybylcclxuICAgICAgZXhwZWN0KG5mdFRyYW5zZmVyT3BlcmF0aW9uLmdldENvZGVjSUQoKSkudG9CZShjb2RlY0lEX3plcm8pXHJcbiAgICAgIGV4cGVjdChuZnRUcmFuc2Zlck9wZXJhdGlvbi5nZXRPcGVyYXRpb25JRCgpKS50b0JlKFxyXG4gICAgICAgIEFWTUNvbnN0YW50cy5ORlRYRkVST1BJRFxyXG4gICAgICApXHJcbiAgICB9KVxyXG5cclxuICAgIHRlc3QoXCJJbnZhbGlkIE5GVFRyYW5zZmVyT3BlcmF0aW9uIGNvZGVjSURcIiwgKCk6IHZvaWQgPT4ge1xyXG4gICAgICBjb25zdCBuZnRUcmFuc2Zlck9wZXJhdGlvbjogTkZUVHJhbnNmZXJPcGVyYXRpb24gPVxyXG4gICAgICAgIG5ldyBORlRUcmFuc2Zlck9wZXJhdGlvbihcclxuICAgICAgICAgIG5ldyBORlRUcmFuc2Zlck91dHB1dCgxMDAwLCBwYXlsb2FkLCBhZGRycywgbG9ja3RpbWUsIDEpXHJcbiAgICAgICAgKVxyXG4gICAgICBleHBlY3QoKCk6IHZvaWQgPT4ge1xyXG4gICAgICAgIG5mdFRyYW5zZmVyT3BlcmF0aW9uLnNldENvZGVjSUQoMilcclxuICAgICAgfSkudG9UaHJvdyhcclxuICAgICAgICBcIkVycm9yIC0gTkZUVHJhbnNmZXJPcGVyYXRpb24uc2V0Q29kZWNJRDogaW52YWxpZCBjb2RlY0lELiBWYWxpZCBjb2RlY0lEcyBhcmUgMCBhbmQgMS5cIlxyXG4gICAgICApXHJcbiAgICB9KVxyXG4gIH0pXHJcblxyXG4gIHRlc3QoXCJUcmFuc2ZlcmFibGVPcGVyYXRpb25cIiwgKCk6IHZvaWQgPT4ge1xyXG4gICAgY29uc3Qgbm91dDogTkZUVHJhbnNmZXJPdXRwdXQgPSBuZXcgTkZUVHJhbnNmZXJPdXRwdXQoXHJcbiAgICAgIDEwMDAsXHJcbiAgICAgIHBheWxvYWQsXHJcbiAgICAgIGFkZHJzLFxyXG4gICAgICBsb2NrdGltZSxcclxuICAgICAgMVxyXG4gICAgKVxyXG4gICAgY29uc3Qgb3A6IE5GVFRyYW5zZmVyT3BlcmF0aW9uID0gbmV3IE5GVFRyYW5zZmVyT3BlcmF0aW9uKG5vdXQpXHJcbiAgICBjb25zdCBuZnR0eGlkOiBCdWZmZXIgPSBCdWZmZXIuZnJvbShcclxuICAgICAgY3JlYXRlSGFzaChcInNoYTI1NlwiKVxyXG4gICAgICAgIC51cGRhdGUoYmludG9vbHMuZnJvbUJOVG9CdWZmZXIobmV3IEJOKDEwMDApLCAzMikpXHJcbiAgICAgICAgLmRpZ2VzdCgpXHJcbiAgICApXHJcbiAgICBjb25zdCBuZnRvdXRwdXRpZHg6IEJ1ZmZlciA9IEJ1ZmZlci5mcm9tKFxyXG4gICAgICBiaW50b29scy5mcm9tQk5Ub0J1ZmZlcihuZXcgQk4oMTAwMCksIDQpXHJcbiAgICApXHJcbiAgICBjb25zdCBuZnR1dHhvOiBVVFhPID0gbmV3IFVUWE8oXHJcbiAgICAgIEFWTUNvbnN0YW50cy5MQVRFU1RDT0RFQyxcclxuICAgICAgbmZ0dHhpZCxcclxuICAgICAgbmZ0b3V0cHV0aWR4LFxyXG4gICAgICBhc3NldElEQnVmZixcclxuICAgICAgbm91dFxyXG4gICAgKVxyXG4gICAgY29uc3QgeGZlcm9wOiBUcmFuc2ZlcmFibGVPcGVyYXRpb24gPSBuZXcgVHJhbnNmZXJhYmxlT3BlcmF0aW9uKFxyXG4gICAgICBhc3NldElEQnVmZixcclxuICAgICAgW25mdHV0eG8uZ2V0VVRYT0lEKCldLFxyXG4gICAgICBvcFxyXG4gICAgKVxyXG5cclxuICAgIGNvbnN0IHhmZXJvcDI6IFRyYW5zZmVyYWJsZU9wZXJhdGlvbiA9IG5ldyBUcmFuc2ZlcmFibGVPcGVyYXRpb24oXHJcbiAgICAgIGFzc2V0SURCdWZmLFxyXG4gICAgICBbQnVmZmVyLmNvbmNhdChbbmZ0dHhpZCwgbmZ0b3V0cHV0aWR4XSldLFxyXG4gICAgICBvcFxyXG4gICAgKVxyXG4gICAgY29uc3QgdWlkOiBVVFhPSUQgPSBuZXcgVVRYT0lEKClcclxuICAgIHVpZC5mcm9tU3RyaW5nKG5mdHV0eG8uZ2V0VVRYT0lEKCkpXHJcbiAgICBjb25zdCB4ZmVyb3AzOiBUcmFuc2ZlcmFibGVPcGVyYXRpb24gPSBuZXcgVHJhbnNmZXJhYmxlT3BlcmF0aW9uKFxyXG4gICAgICBhc3NldElEQnVmZixcclxuICAgICAgW3VpZF0sXHJcbiAgICAgIG9wXHJcbiAgICApXHJcblxyXG4gICAgZXhwZWN0KHhmZXJvcC5nZXRBc3NldElEKCkudG9TdHJpbmcoXCJoZXhcIikpLnRvQmUoYXNzZXRJRClcclxuICAgIGNvbnN0IHV0eG9pZGRlc2VyaWFsaXplZDogQnVmZmVyID0gYmludG9vbHMuY2I1OERlY29kZShcclxuICAgICAgeGZlcm9wLmdldFVUWE9JRHMoKVswXS50b1N0cmluZygpXHJcbiAgICApXHJcbiAgICBleHBlY3QoYmludG9vbHMuYnVmZmVyVG9CNTgodXR4b2lkZGVzZXJpYWxpemVkKSkudG9CZShuZnR1dHhvLmdldFVUWE9JRCgpKVxyXG4gICAgZXhwZWN0KHhmZXJvcC5nZXRPcGVyYXRpb24oKS50b1N0cmluZygpKS50b0JlKG9wLnRvU3RyaW5nKCkpXHJcblxyXG4gICAgY29uc3Qgb3Bjb3B5OiBUcmFuc2ZlcmFibGVPcGVyYXRpb24gPSBuZXcgVHJhbnNmZXJhYmxlT3BlcmF0aW9uKClcclxuICAgIG9wY29weS5mcm9tQnVmZmVyKHhmZXJvcC50b0J1ZmZlcigpKVxyXG4gICAgZXhwZWN0KG9wY29weS50b1N0cmluZygpKS50b0JlKHhmZXJvcC50b1N0cmluZygpKVxyXG5cclxuICAgIGV4cGVjdCh4ZmVyb3AyLnRvQnVmZmVyKCkudG9TdHJpbmcoXCJoZXhcIikpLnRvQmUoXHJcbiAgICAgIHhmZXJvcC50b0J1ZmZlcigpLnRvU3RyaW5nKFwiaGV4XCIpXHJcbiAgICApXHJcbiAgICBleHBlY3QoeGZlcm9wMy50b0J1ZmZlcigpLnRvU3RyaW5nKFwiaGV4XCIpKS50b0JlKFxyXG4gICAgICB4ZmVyb3AudG9CdWZmZXIoKS50b1N0cmluZyhcImhleFwiKVxyXG4gICAgKVxyXG4gIH0pXHJcbn0pXHJcbiJdfQ==